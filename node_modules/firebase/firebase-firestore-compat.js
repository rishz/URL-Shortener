!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(lg,dg){"use strict";try{!(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l,t=e(lg);function n(t){const n=[];let r=0;for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++s)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}const r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const s=[];for(let h=0;h<n.length;h+=3){var i=n[h],a=h+1<n.length,o=a?n[h+1]:0,u=h+2<n.length,c=u?n[h+2]:0;let e=(15&o)<<2|c>>6,t=63&c;u||(t=64,a||(e=64)),s.push(r[i>>2],r[(3&i)<<4|o>>4],r[e],r[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var s,i,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(s=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&s)):239<a&&a<365?(i=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],i=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&i))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let u=0;u<e.length;){var s=n[e.charAt(u++)],i=u<e.length?n[e.charAt(u)]:0;++u;var a=u<e.length?n[e.charAt(u)]:64;++u;var o=u<e.length?n[e.charAt(u)]:64;if(++u,null==s||null==i||null==a||null==o)throw Error();r.push(s<<2|i>>4),64!==a&&(r.push(i<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},a=function(e){return e=e,t=n(e),r.encodeByteArray(t,!0).replace(/\./g,"");var t};function i(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function s(){return!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class o extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,o.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,u.prototype.create)}}class u{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],i=i?(r=n,i.replace(c,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",i=`${this.serviceName}: ${i} (${s}).`;return new o(s,i,n)}}const c=/\{\$([^}]+)}/g;function m(e){return e&&e._delegate?e._delegate:e}class h{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(ld=l=l||{})[ld.DEBUG=0]="DEBUG",ld[ld.VERBOSE=1]="VERBOSE",ld[ld.INFO=2]="INFO",ld[ld.WARN=3]="WARN",ld[ld.ERROR=4]="ERROR",ld[ld.SILENT=5]="SILENT";const d={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},f=l.INFO,g={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},p=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),s=g[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)}};var y,v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w={},I=v||self;function b(){}function T(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function E(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var _="closure_uid_"+(1e9*Math.random()>>>0),S=0;function x(e,t,n){return e.call.apply(e.bind,arguments)}function D(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function A(e,t,n){return(A=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:D).apply(null,arguments)}function C(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function N(e,i){function t(){}t.prototype=i.prototype,e.X=i.prototype,e.prototype=new t,(e.prototype.constructor=e).Wb=function(e,t,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[t].apply(e,r)}}function k(){this.s=this.s,this.o=this.o}k.prototype.s=!1,k.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,_)&&e[_]||(e[_]=++S))},k.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const R=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function L(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function M(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(T(n)){var r=t.length||0,s=n.length||0;t.length=r+s;for(let e=0;e<s;e++)t[r+e]=n[e]}else t.push(n)}}function O(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}O.prototype.h=function(){this.defaultPrevented=!0};var F=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{I.addEventListener("test",b,t),I.removeEventListener("test",b,t)}catch(e){}return e}();function V(e){return/^[\s\xa0]*$/.test(e)}var P=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function q(e,t){return e<t?-1:t<e?1:0}function B(){var e=I.navigator;return(e=e&&e.userAgent)?e:""}function U(e){return-1!=B().indexOf(e)}function G(e){return G[" "](e),e}G[" "]=b;var K,j=U("Opera"),$=U("Trident")||U("MSIE"),Q=U("Edge"),z=Q||$,W=U("Gecko")&&!(-1!=B().toLowerCase().indexOf("webkit")&&!U("Edge"))&&!(U("Trident")||U("MSIE"))&&!U("Edge"),H=-1!=B().toLowerCase().indexOf("webkit")&&!U("Edge");function Y(){var e=I.document;return e?e.documentMode:void 0}e:{var X="",J=(J=B(),W?/rv:([^\);]+)(\)|;)/.exec(J):Q?/Edge\/([\d\.]+)/.exec(J):$?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(J):H?/WebKit\/(\S+)/.exec(J):j?/(?:Version)[ \/]?(\S+)/.exec(J):void 0);if(J&&(X=J?J[1]:""),$){J=Y();if(null!=J&&J>parseFloat(X)){K=String(J);break e}}K=X}var Z={};function ee(){return e=function(){let e=0;var t=P(String(K)).split("."),n=P("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++)for(var s=t[a]||"",i=n[a]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],(0!=s[0].length||0!=i[0].length)&&(e=q(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||q(0==s[2].length,0==i[2].length)||q(s[2],i[2]),s=s[3],i=i[3],0==e););return 0<=e},t=Z,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var te=I.document&&$&&(Y()||parseInt(K,10))||void 0;function ne(e,t){if(O.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(W){e:{try{G(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:re[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&ne.X.h.call(this)}}N(ne,O);var re={2:"touch",3:"pen",4:"mouse"};ne.prototype.h=function(){ne.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var se="closure_listenable_"+(1e6*Math.random()|0),ie=0;function ae(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++ie,this.ba=this.ea=!1}function oe(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function ue(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function ce(e){const t={};for(const n in e)t[n]=e[n];return t}const he="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function le(t){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s])t[n]=r[n];for(let e=0;e<he.length;e++)n=he[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function de(e){this.src=e,this.g={},this.h=0}function fe(e,t){var n,r,s,i=t.type;i in e.g&&(n=e.g[i],(s=0<=(r=R(n,t)))&&Array.prototype.splice.call(n,r,1),s&&(oe(t),0==e.g[i].length&&(delete e.g[i],e.h--)))}function ge(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.ba&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}de.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var a=ge(e,t,r,s);return-1<a?(t=e[a],n||(t.ea=!1)):((t=new ae(t,this.src,i,!!r,s)).ea=n,e.push(t)),t};var me="closure_lm_"+(1e6*Math.random()|0),pe={};function ye(e,t,n,r,s){if(r&&r.once)return function e(t,n,r,s,i){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,s,i);return null}r=_e(r);return t&&t[se]?t.O(n,r,E(s)?!!s.capture:!!s,i):ve(t,n,r,!0,s,i)}(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)ye(e,t[i],n,r,s);return null}return n=_e(n),e&&e[se]?e.N(t,n,E(r)?!!r.capture:!!r,s):ve(e,t,n,!1,r,s)}function ve(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var a=E(s)?!!s.capture:!!s,o=Te(e);if(o||(e[me]=o=new de(e)),(n=o.add(t,n,r,a,i)).proxy)return n;if(r=function(){const n=be;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(s=!F?a:s)&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(Ie(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function we(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[se]?fe(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ie(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Te(t))?(fe(n,e),0==n.h&&(n.src=null,t[me]=null)):oe(e)))}function Ie(e){return e in pe?pe[e]:pe[e]="on"+e}function be(e,t){var n,r;return e=!!e.ba||(t=new ne(t,this),n=e.listener,r=e.ha||e.src,e.ea&&we(e),n.call(r,t))}function Te(e){return(e=e[me])instanceof de?e:null}var Ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function _e(t){return"function"==typeof t?t:(t[Ee]||(t[Ee]=function(e){return t.handleEvent(e)}),t[Ee])}function Se(){k.call(this),this.i=new de(this),(this.P=this).I=null}function xe(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new O(t,e):t instanceof O?t.target=t.target||e:(a=t,le(t=new O(r,e),a)),a=!0,n)for(var s=n.length-1;0<=s;s--)var i=t.g=n[s],a=De(i,r,!0,t)&&a;if(a=De(i=t.g=e,r,!0,t)&&a,a=De(i,r,!1,t)&&a,n)for(s=0;s<n.length;s++)a=De(i=t.g=n[s],r,!1,t)&&a}function De(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var a,o,u=t[i];u&&!u.ba&&u.capture==n&&(a=u.listener,o=u.ha||u.src,u.ea&&fe(e.i,u),s=!1!==a.call(o,r)&&s)}return s&&!r.defaultPrevented}N(Se,k),Se.prototype[se]=!0,Se.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,s,i){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,s,i);else s=E(s)?!!s.capture:!!s,r=_e(r),t&&t[se]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ge(a=t.g[n],r,s,i))&&(oe(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&Te(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?ge(n,r,s,i):t)?n[t]:null)&&we(r))}(this,e,t,n,r)},Se.prototype.M=function(){if(Se.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)oe(n[r]);delete t.g[e],t.h--}}this.I=null},Se.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Se.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ae=I.JSON.stringify;var Ce,Ne=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new ke,e=>e.reset());class ke{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Re(e,t){var n;Ce||(n=I.Promise.resolve(void 0),Ce=function(){n.then(Oe)}),Le||(Ce(),Le=!0),Me.add(e,t)}var Le=!1,Me=new class{constructor(){this.h=this.g=null}add(e,t){const n=Ne.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Oe(){for(var e;e=function(){var e=Me;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){I.setTimeout(()=>{throw e},0)}(e)}var t=Ne;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Le=!1}function Fe(e,t){Se.call(this),this.h=e||1,this.g=t||I,this.j=A(this.lb,this),this.l=Date.now()}function Ve(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Pe(e,t,n){if("function"==typeof e)n&&(e=A(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=A(e.handleEvent,e)}return 2147483647<Number(t)?-1:I.setTimeout(e,t||0)}N(Fe,Se),(y=Fe.prototype).ca=!1,y.R=null,y.lb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),xe(this,"tick"),this.ca&&(Ve(this),this.start())))},y.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},y.M=function(){Fe.X.M.call(this),Ve(this),delete this.g};class qe extends k{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Pe(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(I.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Be(e){k.call(this),this.h=e,this.g={}}N(Be,k);var Ue=[];function Ge(e,t,n,r){Array.isArray(n)||(n&&(Ue[0]=n.toString()),n=Ue);for(var s=0;s<n.length;s++){var i=ye(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function Ke(e){ue(e.g,function(e,t){this.g.hasOwnProperty(t)&&we(e)},e),e.g={}}function je(){this.g=!0}function $e(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var a=1;a<s.length;a++)s[a]=""}}}return Ae(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Be.prototype.M=function(){Be.X.M.call(this),Ke(this)},Be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},je.prototype.Aa=function(){this.g=!1},je.prototype.info=function(){};var Qe={},ze=null;function We(){return ze=ze||new Se}function He(e){O.call(this,Qe.Pa,e)}function Ye(){var e=We();xe(e,new He(e))}function Xe(e,t){O.call(this,Qe.STAT_EVENT,e),this.stat=t}function Je(e){var t=We();xe(t,new Xe(t,e))}function Ze(e,t){O.call(this,Qe.Qa,e),this.size=t}function et(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){e()},t)}Qe.Pa="serverreachability",N(He,O),Qe.STAT_EVENT="statevent",N(Xe,O),Qe.Qa="timingevent",N(Ze,O);var tt={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},nt={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function rt(){}function st(e){return e.h||(e.h=e.i())}function it(){}rt.prototype.h=null;v={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function at(){O.call(this,"d")}function ot(){O.call(this,"c")}function ut(){}function ct(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new Be(this),this.O=dt,this.T=new Fe(e=z?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new ht}function ht(){this.i=null,this.g="",this.h=!1}N(at,O),N(ot,O),N(ut,rt),ut.prototype.g=function(){return new XMLHttpRequest},ut.prototype.i=function(){return{}};var lt=new ut,dt=45e3,ft={},gt={};function mt(e,t,n){e.K=1,e.v=Lt(At(t)),e.s=n,e.P=!0,pt(e,null)}function pt(e,t){e.F=Date.now(),wt(e),e.A=At(e.v);var a,o,u,c,h,l,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Qt(n.i,"t",r),e.C=0,n=e.l.H,e.h=new ht,e.g=Qn(e.l,n?t:null,!e.s),0<e.N&&(e.L=new qe(A(e.La,e,e.g),e.N)),Ge(e.S,e.g,"readystatechange",e.ib),t=e.H?ce(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),Ye(),a=e.j,o=e.u,u=e.A,c=e.m,h=e.U,l=e.s,a.info(function(){if(a.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,s,i=t[n].split("=");1<i.length&&(r=i[0],i=i[1],e=2<=(s=r.split("_")).length&&"type"==s[1]?e+(r+"=")+i+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+o+"\n"+u+"\n"+e})}function yt(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function vt(e,t,n){let r=!0,s;for(;!e.I&&e.C<n.length;){if(s=(a=n,u=o=void 0,o=(i=e).C,-1==(u=a.indexOf("\n",o))?gt:(o=Number(a.substring(o,u)),isNaN(o)?ft:(u+=1)+o>a.length?gt:(a=a.substr(u,o),i.C=u+o,a))),s==gt){4==t&&(e.o=4,Je(14),r=!1),$e(e.j,e.m,null,"[Incomplete Response]");break}if(s==ft){e.o=4,Je(15),$e(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}$e(e.j,e.m,s,null),_t(e,s)}var i,a,o,u;yt(e)&&s!=gt&&s!=ft&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Je(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Pn(t),t.K=!0,Je(11))):($e(e.j,e.m,n,"[Invalid Chunked Response]"),Et(e),Tt(e))}function wt(e){e.V=Date.now()+e.O,It(e,e.O)}function It(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=et(A(e.gb,e),t)}function bt(e){e.B&&(I.clearTimeout(e.B),e.B=null)}function Tt(e){0==e.l.G||e.I||Un(e.l,e)}function Et(e){bt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ve(e.T),Ke(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function _t(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Zt(n.h,e)))if(!e.J&&Zt(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Bn(n),Nn(n)}Vn(n),Je(18)}}else n.Ba=s[1],0<n.Ba-n.T&&s[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=et(A(n.cb,n),6e3));if(Jt(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else Kn(n,11)}else if(!e.J&&n.g!=e||Bn(n),!V(t))for(s=n.Fa.g.parse(t),t=0;t<s.length;t++){var i=s[t];if(n.T=i[0],i=i[1],2==n.G)if("c"==i[0]){n.I=i[1],n.ka=i[2];var a=i[3];null!=a&&(n.ma=a,n.j.info("VER="+n.ma));var o=i[4];null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var u,c,h=i[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;if(g){const m=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;m&&((u=r.h).g||-1==m.indexOf("spdy")&&-1==m.indexOf("quic")&&-1==m.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(en(u,u.h),u.h=null))),!r.D||(c=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=c,Rt(r.F,r.D,c))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var l,d,f=e;(r=n).sa=$n(r,r.H?r.ka:null,r.V),f.J?(tn(r.h,f),l=f,(d=r.J)&&l.setTimeout(d),l.B&&(bt(l),wt(l)),r.g=f):Fn(r),0<n.i.length&&Rn(n)}else"stop"!=i[0]&&"close"!=i[0]||Kn(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Kn(n,7):Cn(n):"noop"!=i[0]&&n.l&&n.l.wa(i),n.A=0)}Ye()}catch(e){}}function St(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(T(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(T(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(T(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}(y=ct.prototype).setTimeout=function(e){this.O=e},y.ib=function(e){e=e.target;const t=this.L;t&&3==En(e)?t.l():this.La(e)},y.La=function(e){try{if(e==this.g)e:{var t=En(this.g),n=this.g.Ea();this.g.aa();if(!(t<3)&&(3!=t||z||this.g&&(this.h.h||this.g.fa()||_n(this.g)))){this.I||4!=t||7==n||Ye(),bt(this);var r=this.g.aa();this.Y=r;t:if(yt(this)){var s=_n(this.g);e="";var i=s.length,a=4==En(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Et(this),Tt(this);var o="";break t}this.h.i=new I.TextDecoder}for(n=0;n<i;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:a&&n==i-1});s.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.U,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.Z&&!this.J){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(u)){var h=u;break t}}h=null}if(!(r=h)){this.i=!1,this.o=3,Je(12),Et(this),Tt(this);break e}$e(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,_t(this,r)}this.P?(vt(this,t,o),z&&this.i&&3==t&&(Ge(this.S,this.T,"tick",this.hb),this.T.start())):($e(this.j,this.m,o,null),_t(this,o)),4==t&&Et(this),this.i&&!this.I&&(4==t?Un(this.l,this):(this.i=!1,wt(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,Je(12)):(this.o=0,Je(13)),Et(this),Tt(this)}}}catch(e){}var l,d,f,g,m,p,y},y.hb=function(){var e,t;this.g&&(e=En(this.g),t=this.g.fa(),this.C<t.length&&(bt(this),vt(this,e,t),this.i&&4!=e&&wt(this)))},y.cancel=function(){this.I=!0,Et(this)},y.gb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(Ye(),Je(17)),Et(this),this.o=2,Tt(this)):It(this,this.V-n)};var xt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Dt(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Dt?(this.h=void 0!==t?t:e.h,Ct(this,e.j),this.s=e.s,this.g=e.g,Nt(this,e.m),this.l=e.l,t=e.i,(n=new Gt).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),kt(this,n),this.o=e.o):e&&(n=String(e).match(xt))?(this.h=!!t,Ct(this,n[1]||"",!0),this.s=Mt(n[2]||""),this.g=Mt(n[3]||"",!0),Nt(this,n[4]),this.l=Mt(n[5]||"",!0),kt(this,n[6]||"",!0),this.o=Mt(n[7]||"")):(this.h=!!t,this.i=new Gt(null,this.h))}function At(e){return new Dt(e)}function Ct(e,t,n){e.j=n?Mt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function kt(e,t,n){var r,s;t instanceof Gt?(e.i=t,r=e.i,(s=e.h)&&!r.j&&(Kt(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(jt(this,t),Qt(this,n,e))},r)),r.j=s):(n||(t=Ot(t,Bt)),e.i=new Gt(t,e.h))}function Rt(e,t,n){e.i.set(t,n)}function Lt(e){return Rt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Mt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ot(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Ft),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Ft(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Dt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ot(t,Vt,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Ot(t,Vt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ot(n,"/"==n.charAt(0)?qt:Pt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ot(n,Ut)),e.join("")};var Vt=/[#\/\?@]/g,Pt=/[#\?:]/g,qt=/[#\?]/g,Bt=/[#\?@]/g,Ut=/#/g;function Gt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Kt(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,s=e[n].indexOf("="),i=null;0<=s?(r=e[n].substring(0,s),i=e[n].substring(s+1)):r=e[n],t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function jt(e,t){Kt(e),t=zt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function $t(e,t){return Kt(e),t=zt(e,t),e.g.has(t)}function Qt(e,t,n){jt(e,t),0<n.length&&(e.i=null,e.g.set(zt(e,t),L(n)),e.h+=n.length)}function zt(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(y=Gt.prototype).add=function(e,t){Kt(this),this.i=null,e=zt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},y.forEach=function(n,r){Kt(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},y.oa=function(){Kt(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let i=0;i<n.length;i++){var s=t[i];for(let e=0;e<s.length;e++)r.push(n[i])}return r},y.W=function(t){Kt(this);let n=[];if("string"==typeof t)$t(this,t)&&(n=n.concat(this.g.get(zt(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},y.set=function(e,t){return Kt(this),this.i=null,$t(this,e=zt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},y.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},y.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],s=encodeURIComponent(String(r)),i=this.W(r),r=0;r<i.length;r++){var a=s;""!==i[r]&&(a+="="+encodeURIComponent(String(i[r]))),e.push(a)}return this.i=e.join("&")};var Wt=class{constructor(e,t){this.h=e,this.g=t}};function Ht(e){this.l=e||10,e=I.PerformanceNavigationTiming?0<(e=I.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(I.g&&I.g.Ga&&I.g.Ga()&&I.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Yt;function Xt(e){return e.h||e.g&&e.g.size>=e.j}function Jt(e){return e.h?1:e.g?e.g.size:0}function Zt(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function en(e,t){e.g?e.g.add(t):e.h=t}function tn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nn(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return L(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function rn(){}function sn(){this.g=new rn}function an(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function on(e){this.l=e.ac||null,this.j=e.jb||!1}function un(e,t){Se.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=cn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ht.prototype.cancel=function(){if(this.i=nn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},rn.prototype.stringify=function(e){return I.JSON.stringify(e,void 0)},rn.prototype.parse=function(e){return I.JSON.parse(e,void 0)},N(on,rt),on.prototype.g=function(){return new un(this.l,this.j)},on.prototype.i=(Yt={},function(){return Yt}),N(un,Se);var cn=0;function hn(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function ln(e){e.readyState=4,e.l=null,e.j=null,e.A=null,dn(e)}function dn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(y=un.prototype).open=function(e,t){if(this.readyState!=cn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,dn(this)},y.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||I).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},y.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ln(this)),this.readyState=cn},y.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,dn(this)),this.g&&(this.readyState=3,dn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==I.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hn(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},y.Ta=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?ln:dn)(this),3==this.readyState&&hn(this))},y.Va=function(e){this.g&&(this.response=this.responseText=e,ln(this))},y.Ua=function(e){this.g&&(this.response=e,ln(this))},y.ga=function(){this.g&&ln(this)},y.setRequestHeader=function(e,t){this.v.append(e,t)},y.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},y.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(un.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var fn=I.JSON.parse;function gn(e){Se.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=mn,this.K=this.L=!1}N(gn,Se);var mn="",pn=/^https?$/i,yn=["POST","PUT"];function vn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,wn(e),bn(e)}function wn(e){e.D||(e.D=!0,xe(e,"complete"),xe(e,"error"))}function In(e){if(e.h&&void 0!==w&&(!e.C[1]||4!=En(e)||2!=e.aa()))if(e.v&&4==En(e))Pe(e.Ha,0,e);else if(xe(e,"readystatechange"),4==En(e)){e.h=!1;try{var t,n,r,s,i=e.aa();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===i)&&(!(s=String(e.H).match(xt)[1]||null)&&I.self&&I.self.location&&(s=(r=I.self.location.protocol).substr(0,r.length-1)),n=!pn.test(s?s.toLowerCase():"")),t=n),t)xe(e,"complete"),xe(e,"success");else{e.m=6;try{var o=2<En(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",wn(e)}}finally{bn(e)}}}function bn(e,t){if(e.g){Tn(e);const n=e.g,r=e.C[0]?b:null;e.g=null,e.C=null,t||xe(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Tn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(I.clearTimeout(e.A),e.A=null)}function En(e){return e.g?e.g.readyState:0}function _n(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case mn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Sn(e){let n="";return ue(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function xn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Sn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Rt(e,t,n))}function Dn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function An(e){this.Ca=0,this.i=[],this.j=new je,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Dn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Dn("baseRetryDelayMs",5e3,e),this.bb=Dn("retryDelaySeedMs",1e4,e),this.$a=Dn("forwardChannelMaxRetries",2,e),this.ta=Dn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new Ht(e&&e.concurrentRequestLimit),this.Fa=new sn,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Cn(e){var t,n;kn(e),3==e.G&&(t=e.U++,Rt(n=At(e.F),"SID",e.I),Rt(n,"RID",t),Rt(n,"TYPE","terminate"),Mn(e,n),(t=new ct(e,e.j,t,void 0)).K=2,t.v=Lt(At(n)),n=!1,!(n=I.navigator&&I.navigator.sendBeacon?I.navigator.sendBeacon(t.v.toString(),""):n)&&I.Image&&((new Image).src=t.v,n=!0),n||(t.g=Qn(t.l,null),t.g.da(t.v)),t.F=Date.now(),wt(t)),jn(e)}function Nn(e){e.g&&(Pn(e),e.g.cancel(),e.g=null)}function kn(e){Nn(e),e.u&&(I.clearTimeout(e.u),e.u=null),Bn(e),e.h.cancel(),e.m&&("number"==typeof e.m&&I.clearTimeout(e.m),e.m=null)}function Rn(e){Xt(e.h)||e.m||(e.m=!0,Re(e.Ja,e),e.C=0)}function Ln(e,t){var n=t?t.m:e.U++,r=At(e.F);Rt(r,"SID",e.I),Rt(r,"RID",n),Rt(r,"AID",e.T),Mn(e,r),e.o&&e.s&&xn(r,e.o,e.s),n=new ct(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=On(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),en(e.h,n),mt(n,r,t)}function Mn(e,n){e.ia&&ue(e.ia,function(e,t){Rt(n,t,e)}),e.l&&St({},function(e,t){Rt(n,t,e)})}function On(e,t,r){r=Math.min(e.i.length,r);var s=e.l?A(e.l.Ra,e.l,e):null;e:{var i=e.i;let n=-1;for(;;){const u=["count="+r];-1==n?0<r?(n=i[0].h,u.push("ofs="+n)):n=0:u.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=i[t].h,o=i[t].g;if((a-=n)<0)n=Math.max(0,i[t].h-100),e=!1;else try{!function(e,r,t){const s=t||"";try{St(e,function(e,t){let n=e;E(e)&&(n=Ae(e)),r.push(s+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(s+"type="+encodeURIComponent("_badmap")),e}}(o,u,"req"+a+"_")}catch(e){s&&s(o)}}if(e){s=u.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,s}function Fn(e){e.g||e.u||(e.Z=1,Re(e.Ia,e),e.A=0)}function Vn(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=et(A(e.Ia,e),Gn(e,e.A)),e.A++,1)}function Pn(e){null!=e.B&&(I.clearTimeout(e.B),e.B=null)}function qn(e){e.g=new ct(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=At(e.sa);Rt(t,"RID","rpc"),Rt(t,"SID",e.I),Rt(t,"CI",e.L?"0":"1"),Rt(t,"AID",e.T),Rt(t,"TYPE","xmlhttp"),Mn(e,t),e.o&&e.s&&xn(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Lt(At(t)),n.s=null,n.P=!0,pt(n,e)}function Bn(e){null!=e.v&&(I.clearTimeout(e.v),e.v=null)}function Un(e,t){var n,r,s,i=null;if(e.g==t){Bn(e),Pn(e),e.g=null;var a=2}else{if(!Zt(e.h,t))return;i=t.D,tn(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(i=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,xe(a=We(),new Ze(a,i)),Rn(e)):Fn(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(s=t,Jt((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=s.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Za?0:r.$a)||(r.m=et(A(r.Ja,r,s),Gn(r,r.C)),r.C++,0))))&&(2!=a||!Vn(e)))switch(i&&0<i.length&&(t=e.h,t.i=t.i.concat(i)),n){case 1:Kn(e,5);break;case 4:Kn(e,10);break;case 3:Kn(e,6);break;default:Kn(e,2)}}function Gn(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function Kn(e,t){var n,r;e.j.info("Error code "+t),2==t?(n=null,e.l&&(n=null),r=A(e.kb,e),n||(n=new Dt("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||Ct(n,"https"),Lt(n)),function(e,t){var n=new je;if(I.Image){const r=new Image;r.onload=C(an,n,r,"TestLoadImage: loaded",!0,t),r.onerror=C(an,n,r,"TestLoadImage: error",!1,t),r.onabort=C(an,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=C(an,n,r,"TestLoadImage: timeout",!1,t),I.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):Je(2),e.G=0,e.l&&e.l.va(t),jn(e),kn(e)}function jn(e){var t;e.G=0,e.la=[],e.l&&(0==(t=nn(e.h)).length&&0==e.i.length||(M(e.la,t),M(e.la,e.i),e.h.i.length=0,L(e.i),e.i.length=0),e.l.ua())}function $n(e,t,n){var r,s,i=n instanceof Dt?At(n):new Dt(n,void 0);return""!=i.g?(t&&(i.g=t+"."+i.g),Nt(i,i.m)):(i=(r=I.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,s=new Dt(null,void 0),i&&Ct(s,i),t&&(s.g=t),r&&Nt(s,r),n&&(s.l=n),i=s),n=e.D,t=e.za,n&&t&&Rt(i,n,t),Rt(i,"VER",e.ma),Mn(e,i),i}function Qn(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new gn(new on({jb:!0})):new gn(e.ra)).Ka(e.H),t}function zn(){}function Wn(){if($&&!(10<=Number(te)))throw Error("Environmental error: no available transport.")}function Hn(e,t){Se.call(this),this.g=new An(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!V(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!V(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Jn(this)}function Yn(e){at.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Xn(){ot.call(this),this.status=1}function Jn(e){this.g=e}(y=gn.prototype).Ka=function(e){this.L=e},y.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||lt).g(),this.C=this.u?st(this.u):st(lt),this.g.onreadystatechange=A(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void vn(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const u of r.keys())n.set(u,r.get(u))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=I.FormData&&e instanceof I.FormData,0<=R(yn,t)&&!r&&!s&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[i,a]of n)this.g.setRequestHeader(i,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Tn(this),0<this.B&&((this.K=(o=this.g,$&&ee()&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=A(this.qa,this)):this.A=Pe(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){vn(this,e)}var o},y.qa=function(){void 0!==w&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xe(this,"timeout"),this.abort(8))},y.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,xe(this,"complete"),xe(this,"abort"),bn(this))},y.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),bn(this,!0)),gn.X.M.call(this)},y.Ha=function(){this.s||(this.F||this.v||this.l?In(this):this.fb())},y.fb=function(){In(this)},y.aa=function(){try{return 2<En(this)?this.g.status:-1}catch(e){return-1}},y.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},y.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),fn(t)}},y.Ea=function(){return this.m},y.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(y=An.prototype).ma=8,y.G=1,y.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new ct(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?(e=ce(e),le(e,this.S)):e=this.S),null!==this.o||this.N||(i.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var s=this.i[r];if("__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(n+=s)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=On(this,i,n),Rt(r=At(this.F),"RID",t),Rt(r,"CVER",22),this.D&&Rt(r,"X-HTTP-Session-Id",this.D),Mn(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(Sn(e)))+"&"+n:this.o&&xn(r,this.o,e)),en(this.h,i),this.Ya&&Rt(r,"TYPE","init"),this.O?(Rt(r,"$req",n),Rt(r,"SID","null"),i.Z=!0,mt(i,r,null)):mt(i,r,n),this.G=2}}else 3==this.G&&(t?Ln(this,t):0==this.i.length||Xt(this.h)||Ln(this))},y.Ia=function(){var e;this.u=null,qn(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=et(A(this.eb,this),e))},y.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Je(10),Nn(this),qn(this))},y.cb=function(){null!=this.v&&(this.v=null,Nn(this),Vn(this),Je(19))},y.kb=function(e){e?(this.j.info("Successfully pinged google.com"),Je(2)):(this.j.info("Failed to ping google.com"),Je(1))},(y=zn.prototype).xa=function(){},y.wa=function(){},y.va=function(){},y.ua=function(){},y.Ra=function(){},Wn.prototype.g=function(e,t){return new Hn(e,t)},N(Hn,Se),Hn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;Je(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=$n(e,null,e.V),Rn(e)},Hn.prototype.close=function(){Cn(this.g)},Hn.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Ae(e),e=t),n.i.push(new Wt(n.ab++,e)),3==n.G&&Rn(n)},Hn.prototype.M=function(){this.g.l=null,delete this.j,Cn(this.g),delete this.g,Hn.X.M.call(this)},N(Yn,at),N(Xn,ot),N(Jn,zn),Jn.prototype.xa=function(){xe(this.g,"a")},Jn.prototype.wa=function(e){xe(this.g,new Yn(e))},Jn.prototype.va=function(e){xe(this.g,new Xn)},Jn.prototype.ua=function(){xe(this.g,"b")},Wn.prototype.createWebChannel=Wn.prototype.g,Hn.prototype.send=Hn.prototype.u,Hn.prototype.open=Hn.prototype.m,tt.NO_ERROR=0,tt.TIMEOUT=8,tt.HTTP_ERROR=6,nt.COMPLETE="complete",(it.EventType=v).OPEN="a",v.CLOSE="b",v.ERROR="c",v.MESSAGE="d",Se.prototype.listen=Se.prototype.N,gn.prototype.listenOnce=gn.prototype.O,gn.prototype.getLastError=gn.prototype.Oa,gn.prototype.getLastErrorCode=gn.prototype.Ea,gn.prototype.getStatus=gn.prototype.aa,gn.prototype.getResponseJson=gn.prototype.Sa,gn.prototype.getResponseText=gn.prototype.fa,gn.prototype.send=gn.prototype.da,gn.prototype.setWithCredentials=gn.prototype.Ka;var Zn,er=We,tr=tt,nr=nt,rr=Qe,sr=10,ir=11,ar=on,or=it,ur=gn;const cr="@firebase/firestore";class hr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}hr.UNAUTHENTICATED=new hr(null),hr.GOOGLE_CREDENTIALS=new hr("google-credentials-uid"),hr.FIRST_PARTY=new hr("first-party-uid"),hr.MOCK_USER=new hr("mock-user");let lr="9.15.0";const dr=new class{constructor(e){this.name=e,this._logLevel=f,this._logHandler=p,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?d[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function fr(){return dr.logLevel}function gr(e,...t){var n;dr.logLevel<=l.DEBUG&&(n=t.map(yr),dr.debug(`Firestore (${lr}): ${e}`,...n))}function mr(e,...t){var n;dr.logLevel<=l.ERROR&&(n=t.map(yr),dr.error(`Firestore (${lr}): ${e}`,...n))}function pr(e,...t){var n;dr.logLevel<=l.WARN&&(n=t.map(yr),dr.warn(`Firestore (${lr}): ${e}`,...n))}function yr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function vr(e="Unexpected state"){var t=`FIRESTORE (${lr}) INTERNAL ASSERTION FAILED: `+e;throw mr(t),new Error(t)}function wr(e){e||vr()}const Ir={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class br extends o{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Tr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Er{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _r{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(hr.UNAUTHENTICATED))}shutdown(){}}class Sr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class xr{constructor(e){this.t=e,this.currentUser=hr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const s=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let i=new Tr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Tr,t.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await s(this.currentUser)})},o=e=>{gr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(gr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Tr))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(gr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(wr("string"==typeof e.accessToken),new Er(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return wr(null===e||"string"==typeof e),new hr(e)}}class Dr{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=hr.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(wr(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Ar{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new Dr(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(hr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Cr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Nr{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,n){const r=e=>{null!=e.error&&gr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.A;return this.A=e.token,gr("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const s=e=>{gr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit(e=>s(e)),setTimeout(()=>{var e;this.appCheck||((e=this.T.getImmediate({optional:!0}))?s(e):gr("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(wr("string"==typeof e.token),this.A=e.token,new Cr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class kr{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var s=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<s.length;++e)r.length<20&&s[e]<n&&(r+=t.charAt(s[e]%t.length))}return r}}function Rr(e,t){return e<t?-1:t<e?1:0}function Lr(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Mr(e){return e+"\0"}class Or{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new br(Ir.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new br(Ir.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new br(Ir.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new br(Ir.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Or.fromMillis(Date.now())}static fromDate(e){return Or.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Or(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Rr(this.nanoseconds,e.nanoseconds):Rr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Fr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Fr(e)}static min(){return new Fr(new Or(0,0))}static max(){return new Fr(new Or(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Vr{constructor(e,t,n){void 0===t?t=0:t>e.length&&vr(),void 0===n?n=e.length-t:n>e.length-t&&vr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Vr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Vr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),s=t.get(r);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Pr extends Vr{construct(e,t,n){return new Pr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new br(Ir.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new Pr(t)}static emptyPath(){return new Pr([])}}const qr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Br extends Vr{construct(e,t,n){return new Br(e,t,n)}static isValidIdentifier(e){return qr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!Br.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Br(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var s=()=>{if(0===n.length)throw new br(Ir.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new br(Ir.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new br(Ir.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?i=!i:"."!==t||i?n+=t:s(),r++}if(s(),i)throw new br(Ir.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Br(t)}static emptyPath(){return new Br([])}}class Ur{constructor(e){this.path=e}static fromPath(e){return new Ur(Pr.fromString(e))}static fromName(e){return new Ur(Pr.fromString(e).popFirst(5))}static empty(){return new Ur(Pr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Pr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Pr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ur(new Pr(e.slice()))}}class Gr{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Kr(e){return e.fields.find(e=>2===e.kind)}function jr(e){return e.fields.filter(e=>2!==e.kind)}Gr.UNKNOWN_ID=-1;class $r{constructor(e,t){this.fieldPath=e,this.kind=t}}class Qr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qr(0,Hr.min())}}function zr(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=Fr.fromTimestamp(1e9===r?new Or(n+1,0):new Or(n,r));return new Hr(r,Ur.empty(),t)}function Wr(e){return new Hr(e.readTime,e.key,-1)}class Hr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Hr(Fr.min(),Ur.empty(),-1)}static max(){return new Hr(Fr.max(),Ur.empty(),-1)}}function Yr(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Ur.comparator(e.documentKey,t.documentKey),0!==n?n:Rr(e.largestBatchId,t.largestBatchId))}const Xr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Jr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Zr(e){if(e.code!==Ir.FAILED_PRECONDITION||e.message!==Xr)throw e;gr("LocalStore","Unexpectedly lost primary lease")}class es{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,s){return this.callbackAttached&&vr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(r,this.result):new es((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(s,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof es?t:es.resolve(t)}catch(e){return es.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):es.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):es.reject(t)}static resolve(n){return new es((e,t)=>{e(n)})}static reject(n){return new es((e,t)=>{t(n)})}static waitFor(e){return new es((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=es.resolve(!1);for(const n of e)t=t.next(e=>e?es.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,u){return new es((t,n)=>{const r=o.length,s=new Array(r);let i=0;for(let e=0;e<r;e++){const a=e;u(o[a]).next(e=>{s[a]=e,++i,i===r&&t(s)},e=>n(e))}})}static doWhile(r,s){return new es((e,t)=>{const n=()=>{!0===r()?s().next(()=>{n()},t):e()};n()})}}class ts{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.P=new Tr,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new ss(n,e.error)):this.P.resolve()},this.transaction.onerror=e=>{var t=cs(e.target.error);this.P.reject(new ss(n,t))}}static open(e,t,n,r){try{return new ts(t,e.transaction(r,n))}catch(e){throw new ss(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(gr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new as(t)}}class ns{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===ns.D(i())&&mr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return gr("SimpleDb","Removing database:",e),os(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return}}())return!1;if(ns.N())return!0;const e=i(),t=ns.D(e),n=0<t&&t<10,r=ns.k(e),s=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(i){return this.db||(gr("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=e=>{var t=e.target.result;n(t)},s.onblocked=()=>{r(new ss(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new br(Ir.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new br(Ir.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new ss(i,t))},s.onupgradeneeded=e=>{gr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.S.$(t,s.transaction,e.oldVersion,this.version).next(()=>{gr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.F(e);const t=ts.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),es.reject(e))).toPromise();return i.catch(()=>{}),await t.v,i}catch(e){const t=e,n="FirebaseError"!==t.name&&i<3;if(gr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class rs{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return os(this.q.delete())}}class ss extends br{constructor(e,t){super(Ir.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function is(e){return"IndexedDbTransactionError"===e.name}class as{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(gr("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(gr("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),os(n)}add(e){return gr("SimpleDb","ADD",this.store.name,e,e),os(this.store.add(e))}get(t){return os(this.store.get(t)).next(e=>(gr("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return gr("SimpleDb","DELETE",this.store.name,e),os(this.store.delete(e))}count(){return gr("SimpleDb","COUNT",this.store.name),os(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.H(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new es((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new es((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}Y(e,t){gr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;var r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.H(r,t)}tt(s){const e=this.cursor({});return new es((n,r)=>{e.onerror=e=>{var t=cs(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?s(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}H(e,i){const a=[];return new es((s,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new rs(t),r=i(t.primaryKey,t.value,n);if(r instanceof es){const e=r.catch(e=>(n.done(),es.reject(e)));a.push(e)}n.isDone?s():null===n.G?t.continue():t.continue(n.G)}else s()}}).next(()=>es.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function os(e){return new es((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=cs(e.target.error);r(t)}})}let us=!1;function cs(e){const t=ns.D(i());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new br("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return us||(us=!0,setTimeout(()=>{throw e},0)),e}}return e}class hs{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){gr("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{gr("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){is(e)?gr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await Zr(e)}await this.nt(6e4)})}}class ls{constructor(e,t){this.localStore=e,this.persistence=t}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(e,t){const n=new Set;let r=t,s=!0;return es.doWhile(()=>!0===s&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(s=!1):(gr("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}rt(r,s,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,s).next(n=>this.localStore.localDocuments.getNextDocuments(r,s,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ot(n,e)).next(e=>(gr("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,s,e))).next(()=>t.size)}))}ot(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=Wr(t);0<Yr(n,r)&&(r=n)}),new Hr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ds{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}ds.at=-1;class fs{constructor(e,t,n,r,s,i,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class gs{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new gs("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof gs&&e.projectId===this.projectId&&e.database===this.database}}function ms(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ps(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ys(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function vs(e){return null==e}function ws(e){return 0===e&&1/e==-1/0}function Is(e){return"number"==typeof e&&Number.isInteger(e)&&!ws(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class bs{constructor(e){this.binaryString=e}static fromBase64String(e){var t=atob(e);return new bs(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new bs(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Rr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}bs.EMPTY_BYTE_STRING=new bs("");const Ts=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Es(t){if(wr(!!t),"string"!=typeof t)return{seconds:_s(t.seconds),nanos:_s(t.nanos)};{let e=0;var n=Ts.exec(t);wr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function _s(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ss(e){return"string"==typeof e?bs.fromBase64String(e):bs.fromUint8Array(e)}function xs(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ds(e){var t=Es(e.mapValue.fields.__local_write_time__.timestampValue);return new Or(t.seconds,t.nanos)}const As={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Cs={nullValue:"NULL_VALUE"};function Ns(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?xs(e)?4:Ks(e)?9007199254740991:10:vr()}function ks(r,s){if(r===s)return!0;var e,t,n=Ns(r);if(n!==Ns(s))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===s.booleanValue;case 4:return Ds(r).isEqual(Ds(s));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=Es(r.timestampValue),n=Es(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(s);case 5:return r.stringValue===s.stringValue;case 6:return t=s,Ss(r.bytesValue).isEqual(Ss(t.bytesValue));case 7:return r.referenceValue===s.referenceValue;case 8:return e=s,_s((t=r).geoPointValue.latitude)===_s(e.geoPointValue.latitude)&&_s(t.geoPointValue.longitude)===_s(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return _s(e.integerValue)===_s(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=_s(e.doubleValue),r=_s(t.doubleValue);return n===r?ws(n)===ws(r):isNaN(n)&&isNaN(r)}return!1}(r,s);case 9:return Lr(r.arrayValue.values||[],s.arrayValue.values||[],ks);case 10:return function(e){const t=e.mapValue.fields||{},n=s.mapValue.fields||{};if(ms(t)!==ms(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!ks(t[e],n[e])))return!1;return!0}(r);default:return vr()}}function Rs(e,t){return void 0!==(e.values||[]).find(e=>ks(e,t))}function Ls(e,t){if(e===t)return 0;var n,r,s,i,a=Ns(e),o=Ns(t);if(a!==o)return Rr(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return Rr(e.booleanValue,t.booleanValue);case 2:return r=t,s=_s(e.integerValue||e.doubleValue),i=_s(r.integerValue||r.doubleValue),s<i?-1:i<s?1:s===i?0:isNaN(s)?isNaN(i)?0:-1:1;case 3:return Ms(e.timestampValue,t.timestampValue);case 4:return Ms(Ds(e),Ds(t));case 5:return Rr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ss(e),r=Ss(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=Rr(n[s],r[s]);if(0!==t)return t}return Rr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(i=Rr(_s(n.latitude),_s(r.latitude)))?i:Rr(_s(n.longitude),_s(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=Ls(n[s],r[s]);if(t)return t}return Rr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===As.mapValue&&t===As.mapValue)return 0;if(e===As.mapValue)return 1;if(t===As.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const t=Rr(r[o],i[o]);if(0!==t)return t;var a=Ls(n[r[o]],s[i[o]]);if(0!==a)return a}return Rr(r.length,i.length)}(e.mapValue,t.mapValue);default:throw vr()}}function Ms(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Rr(e,t);var n=Es(e),r=Es(t),s=Rr(n.seconds,r.seconds);return 0!==s?s:Rr(n.nanos,r.nanos)}function Os(e){return function i(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Es(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ss(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,Ur.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=i(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${i(e.fields[s])}`;return n+"}"}(e.mapValue):vr();var t}(e)}function Fs(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Vs(e){return e&&"integerValue"in e}function Ps(e){return!!e&&"arrayValue"in e}function qs(e){return e&&"nullValue"in e}function Bs(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Us(e){return e&&"mapValue"in e}function Gs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return ps(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Gs(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Gs(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Ks(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function js(e,t){var n=Ls(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function $s(e,t){var n=Ls(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Qs{constructor(e,t){this.position=e,this.inclusive=t}}function zs(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],a=e.position[s];if(r=i.field.isKeyField()?Ur.comparator(Ur.fromName(a.referenceValue),n.key):Ls(a,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Ws(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ks(e.position[n],t.position[n]))return!1;return!0}class Hs{}class Ys extends Hs{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new si(e,t,n):"array-contains"===t?new ui(e,n):"in"===t?new ci(e,n):"not-in"===t?new hi(e,n):"array-contains-any"===t?new li(e,n):new Ys(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?ii:ai)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ls(t,this.value)):null!==t&&Ns(this.value)===Ns(t)&&this.matchesComparison(Ls(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return vr()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Xs extends Hs{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new Xs(e,t)}matches(t){return Js(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Js(e){return"and"===e.op}function Zs(e){return"or"===e.op}function ei(e){return ti(e)&&Js(e)}function ti(e){for(const t of e.filters)if(t instanceof Xs)return!1;return!0}function ni(e,t){var n=e.filters.concat(t);return Xs.create(n,e.op)}function ri(e){return e instanceof Ys?`${(t=e).field.canonicalString()} ${t.op} ${Os(t.value)}`:e instanceof Xs?(e=e).op.toString()+" {"+e.getFilters().map(ri).join(" ,")+"}":"Filter";var t}class si extends Ys{constructor(e,t,n){super(e,t,n),this.key=Ur.fromName(n.referenceValue)}matches(e){var t=Ur.comparator(e.key,this.key);return this.matchesComparison(t)}}class ii extends Ys{constructor(e,t){super(e,"in",t),this.keys=oi(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class ai extends Ys{constructor(e,t){super(e,"not-in",t),this.keys=oi(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function oi(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Ur.fromName(e.referenceValue))}class ui extends Ys{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return Ps(t)&&Rs(t.arrayValue,this.value)}}class ci extends Ys{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Rs(this.value.arrayValue,t)}}class hi extends Ys{constructor(e,t){super(e,"not-in",t)}matches(e){if(Rs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Rs(this.value.arrayValue,t)}}class li extends Ys{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ps(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Rs(this.value.arrayValue,e))}}class di{constructor(e,t="asc"){this.field=e,this.dir=t}}class fi{constructor(e,t){this.comparator=e,this.root=t||mi.EMPTY}insert(e,t){return new fi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mi.BLACK,null,null))}remove(e){return new fi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new gi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new gi(this.root,e,this.comparator,!1)}getReverseIterator(){return new gi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new gi(this.root,e,this.comparator,!0)}}class gi{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class mi{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:mi.RED,this.left=null!=r?r:mi.EMPTY,this.right=null!=s?s:mi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new mi(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return mi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return mi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,mi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,mi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw vr();if(this.right.isRed())throw vr();var e=this.left.check();if(e!==this.right.check())throw vr();return e+(this.isRed()?0:1)}}mi.EMPTY=null,mi.RED=!0,mi.BLACK=!1,mi.EMPTY=new class{constructor(){this.size=0}get key(){throw vr()}get value(){throw vr()}get color(){throw vr()}get left(){throw vr()}get right(){throw vr()}copy(e,t,n,r,s){return this}insert(e,t,n){return new mi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class pi{constructor(e){this.comparator=e,this.data=new fi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yi(this.data.getIterator())}getIteratorFrom(e){return new yi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof pi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new pi(this.comparator);return t.data=e,t}}class yi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function vi(e){return e.hasNext()?e.getNext():void 0}class wi{constructor(e){(this.fields=e).sort(Br.comparator)}static empty(){return new wi([])}unionWith(e){let t=new pi(Br.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new wi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Lr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ii{constructor(e){this.value=e}static empty(){return new Ii({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!Us(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gs(t)}setAll(e){let n=Br.emptyPath(),r={},s=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,s),r={},s=[],n=t.popLast()}e?r[t.lastSegment()]=Gs(e):s.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,s)}delete(e){const t=this.field(e.popLast());Us(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ks(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];Us(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){ps(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new Ii(Gs(this.value))}}class bi{constructor(e,t,n,r,s,i,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=a}static newInvalidDocument(e){return new bi(e,0,Fr.min(),Fr.min(),Fr.min(),Ii.empty(),0)}static newFoundDocument(e,t,n,r){return new bi(e,1,t,Fr.min(),n,r,0)}static newNoDocument(e,t){return new bi(e,2,t,Fr.min(),Fr.min(),Ii.empty(),0)}static newUnknownDocument(e,t){return new bi(e,3,t,Fr.min(),Fr.min(),Ii.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Fr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ii.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ii.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof bi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new bi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ti{constructor(e,t=null,n=[],r=[],s=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=a,this.ft=null}}function Ei(e,t=null,n=[],r=[],s=null,i=null,a=null){return new Ti(e,t,n,r,s,i,a)}function _i(e){const t=e;if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function t(e){if(e instanceof Ys)return e.field.canonicalString()+e.op.toString()+Os(e.value);var n=e.filters.map(e=>t(e)).join(",");return`${e.op}(${n})`}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),vs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Os(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Os(e)).join(",")),t.ft=e}return t.ft}function Si(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<e.orderBy.length;s++)if(n=e.orderBy[s],r=t.orderBy[s],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(!function r(e,t){return e instanceof Ys?(n=e,(i=t)instanceof Ys&&n.op===i.op&&n.field.isEqual(i.field)&&ks(n.value,i.value)):e instanceof Xs?(s=t)instanceof Xs&&e.op===s.op&&e.filters.length===s.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,s.filters[n]),!0):void vr();var s,n,i}(e.filters[i],t.filters[i]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ws(e.startAt,t.startAt)&&Ws(e.endAt,t.endAt)}function xi(e){return Ur.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Di(e,t){return e.filters.filter(e=>e instanceof Ys&&e.field.isEqual(t))}function Ai(t,n,r){let s=Cs,i=!0;for(const r of Di(t,n)){let e=Cs,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?Cs:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Fs(gs.empty(),Ur.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:vr();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=Cs}js({value:s,inclusive:i},{value:e,inclusive:t})<0&&(s=e,i=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];js({value:s,inclusive:i},{value:t,inclusive:r.inclusive})<0&&(s=t,i=r.inclusive);break}return{value:s,inclusive:i}}function Ci(t,n,r){let s=As,i=!0;for(const r of Di(t,n)){let e=As,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Fs(gs.empty(),Ur.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?As:vr(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=As}0<$s({value:s,inclusive:i},{value:e,inclusive:t})&&(s=e,i=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<$s({value:s,inclusive:i},{value:t,inclusive:r.inclusive})&&(s=t,i=r.inclusive);break}return{value:s,inclusive:i}}class Ni{constructor(e,t=null,n=[],r=[],s=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function ki(e,t,n,r,s,i,a,o){return new Ni(e,t,n,r,s,i,a,o)}function Ri(e){return new Ni(e)}function Li(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Mi(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Oi(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Fi(e){return null!==e.collectionGroup}function Vi(t){const n=t;if(null===n.dt){n.dt=[];const t=Oi(n),e=Mi(n);if(null!==t&&null===e)t.isKeyField()||n.dt.push(new di(t)),n.dt.push(new di(Br.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.dt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.dt.push(new di(Br.keyField(),t))}}}return n.dt}function Pi(e){const t=e;if(!t._t)if("F"===t.limitType)t._t=Ei(t.path,t.collectionGroup,Vi(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const s of Vi(t)){const t="desc"===s.dir?"asc":"desc";e.push(new di(s.field,t))}var n=t.endAt?new Qs(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Qs(t.startAt.position,t.startAt.inclusive):null;t._t=Ei(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function qi(e,t){t.getFirstInequalityField(),Oi(e);var n=e.filters.concat([t]);return new Ni(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Bi(e,t,n){return new Ni(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Ui(e,t){return Si(Pi(e),Pi(t))&&e.limitType===t.limitType}function Gi(e){return`${_i(Pi(e))}|lt:${e.limitType}`}function Ki(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>ri(e)).join(", ")}]`),vs(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Os(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Os(e)).join(",")),`Target(${t})`}(Pi(e))}; limitType=${e.limitType})`}function ji(n,e){return e.isFoundDocument()&&(s=n,a=(i=e).key.path,null!==s.collectionGroup?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(a):Ur.isDocumentKey(s.path)?s.path.isEqual(a):s.path.isImmediateParentOf(a))&&function(e){for(const t of Vi(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(s=e,(!(e=n).startAt||(t=e.startAt,r=zs(t,Vi(e),s),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=zs(t,Vi(e),s),t.inclusive?0<=r:0<r)));var t,r,s,i,a}function $i(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Qi(s){return(e,t)=>{let n=!1;for(const r of Vi(s)){const s=function(e,s,t){var n=e.field.isKeyField()?Ur.comparator(s.key,t.key):function(e,t){var n=s.data.field(e),r=t.data.field(e);return null!==n&&null!==r?Ls(n,r):vr()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return vr()}}(r,e,t);if(0!==s)return s;n=n||r.field.isKeyField()}return 0}}function zi(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ws(t)?"-0":t}}function Wi(e){return{integerValue:""+e}}function Hi(e,t){return Is(t)?Wi(t):zi(e,t)}class Yi{constructor(){this._=void 0}}function Xi(e,t){return e instanceof ra?Vs(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class Ji extends Yi{}class Zi extends Yi{constructor(e){super(),this.elements=e}}function ea(e,t){const n=ia(t);for(const t of e.elements)n.some(e=>ks(e,t))||n.push(t);return{arrayValue:{values:n}}}class ta extends Yi{constructor(e){super(),this.elements=e}}function na(e,t){let n=ia(t);for(const t of e.elements)n=n.filter(e=>!ks(e,t));return{arrayValue:{values:n}}}class ra extends Yi{constructor(e,t){super(),this.yt=e,this.gt=t}}function sa(e){return _s(e.integerValue||e.doubleValue)}function ia(e){return Ps(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class aa{constructor(e,t){this.field=e,this.transform=t}}class oa{constructor(e,t){this.version=e,this.transformResults=t}}class ua{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ua}static exists(e){return new ua(void 0,e)}static updateTime(e){return new ua(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ca(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ha{}function la(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new Ia(e.key,ua.none()):new ma(e.key,e.data,ua.none());{const s=e.data,i=Ii.empty();let t=new pi(Br.comparator);for(var r of n.fields)if(!t.has(r)){let e=s.field(r);null===e&&1<r.length&&(r=r.popLast(),e=s.field(r)),null===e?i.delete(r):i.set(r,e),t=t.add(r)}return new pa(e.key,i,new wi(t.toArray()),ua.none())}}function da(e,t,n){e instanceof ma?function(e,t,n){const r=e.value.clone(),s=va(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof pa?function(e,t,n){if(!ca(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=va(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(ya(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function fa(e,t,n,r){return e instanceof ma?function(e,t,n,r){if(!ca(e.precondition,t))return n;const s=e.value.clone(),i=wa(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof pa?function(e,t,n,r){if(!ca(e.precondition,t))return n;const s=wa(e.fieldTransforms,r,t),i=t.data;return i.setAll(ya(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,ca(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function ga(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Lr(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof Zi&&t instanceof Zi||e instanceof ta&&t instanceof ta?Lr(e.elements,t.elements,ks):e instanceof ra&&t instanceof ra?ks(e.gt,t.gt):e instanceof Ji&&t instanceof Ji)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class ma extends ha{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class pa extends ha{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function ya(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function va(e,t,n){const r=new Map;wr(e.length===n.length);for(let h=0;h<n.length;h++){var s=e[h],i=s.transform,a=t.data.field(s.field);r.set(s.field,(o=i,u=a,c=n[h],o instanceof Zi?ea(o,u):o instanceof ta?na(o,u):c))}var o,u,c;return r}function wa(e,t,n){const r=new Map;for(const c of e){const e=c.transform,h=n.data.field(c.field);r.set(c.field,(s=e,i=h,a=t,u=o=void 0,s instanceof Ji?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&(e.fields.__previous_value__=i),{mapValue:e}}():s instanceof Zi?ea(s,i):s instanceof ta?na(s,i):(o=Xi(s=s,i),u=sa(o)+sa(s.gt),Vs(o)&&Vs(s.gt)?Wi(u):zi(s.yt,u))))}var s,i,a,o,u;return r}class Ia extends ha{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ba extends ha{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ta{constructor(e){this.count=e}}function Ea(e){switch(e){default:return vr(),0;case Ir.CANCELLED:case Ir.UNKNOWN:case Ir.DEADLINE_EXCEEDED:case Ir.RESOURCE_EXHAUSTED:case Ir.INTERNAL:case Ir.UNAVAILABLE:case Ir.UNAUTHENTICATED:return;case Ir.INVALID_ARGUMENT:case Ir.NOT_FOUND:case Ir.ALREADY_EXISTS:case Ir.PERMISSION_DENIED:case Ir.FAILED_PRECONDITION:case Ir.ABORTED:case Ir.OUT_OF_RANGE:case Ir.UNIMPLEMENTED:case Ir.DATA_LOSS:return 1}}function _a(e){if(void 0===e)return mr("GRPC error has no .code"),Ir.UNKNOWN;switch(e){case Zn.OK:return Ir.OK;case Zn.CANCELLED:return Ir.CANCELLED;case Zn.UNKNOWN:return Ir.UNKNOWN;case Zn.DEADLINE_EXCEEDED:return Ir.DEADLINE_EXCEEDED;case Zn.RESOURCE_EXHAUSTED:return Ir.RESOURCE_EXHAUSTED;case Zn.INTERNAL:return Ir.INTERNAL;case Zn.UNAVAILABLE:return Ir.UNAVAILABLE;case Zn.UNAUTHENTICATED:return Ir.UNAUTHENTICATED;case Zn.INVALID_ARGUMENT:return Ir.INVALID_ARGUMENT;case Zn.NOT_FOUND:return Ir.NOT_FOUND;case Zn.ALREADY_EXISTS:return Ir.ALREADY_EXISTS;case Zn.PERMISSION_DENIED:return Ir.PERMISSION_DENIED;case Zn.FAILED_PRECONDITION:return Ir.FAILED_PRECONDITION;case Zn.ABORTED:return Ir.ABORTED;case Zn.OUT_OF_RANGE:return Ir.OUT_OF_RANGE;case Zn.UNIMPLEMENTED:return Ir.UNIMPLEMENTED;case Zn.DATA_LOSS:return Ir.DATA_LOSS;default:return vr()}}(nt=Zn=Zn||{})[nt.OK=0]="OK",nt[nt.CANCELLED=1]="CANCELLED",nt[nt.UNKNOWN=2]="UNKNOWN",nt[nt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nt[nt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nt[nt.NOT_FOUND=5]="NOT_FOUND",nt[nt.ALREADY_EXISTS=6]="ALREADY_EXISTS",nt[nt.PERMISSION_DENIED=7]="PERMISSION_DENIED",nt[nt.UNAUTHENTICATED=16]="UNAUTHENTICATED",nt[nt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nt[nt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nt[nt.ABORTED=10]="ABORTED",nt[nt.OUT_OF_RANGE=11]="OUT_OF_RANGE",nt[nt.UNIMPLEMENTED=12]="UNIMPLEMENTED",nt[nt.INTERNAL=13]="INTERNAL",nt[nt.UNAVAILABLE=14]="UNAVAILABLE",nt[nt.DATA_LOSS=15]="DATA_LOSS";class Sa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){ps(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return ys(this.inner)}size(){return this.innerSize}}const xa=new fi(Ur.comparator);const Da=new fi(Ur.comparator);function Aa(...e){let t=Da;for(const n of e)t=t.insert(n.key,n);return t}function Ca(e){let n=Da;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function Na(){return new Sa(e=>e.toString(),(e,t)=>e.isEqual(t))}const ka=new fi(Ur.comparator),Ra=new pi(Ur.comparator);function La(...e){let t=Ra;for(const n of e)t=t.add(n);return t}const Ma=new pi(Rr);class Oa{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Fa.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Oa(Fr.min(),r,Ma,xa,La())}}class Fa{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Fa(n,t,La(),La(),La())}}class Va{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class Pa{constructor(e,t){this.targetId=e,this.Et=t}}class qa{constructor(e,t,n=bs.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Ba{constructor(){this.At=0,this.Rt=Ka(),this.bt=bs.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){0<e.approximateByteSize()&&(this.vt=!0,this.bt=e)}Ct(){let n=La(),r=La(),s=La();return this.Rt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:s=s.add(e);break;default:vr()}}),new Fa(this.bt,this.Pt,n,r,s)}xt(){this.vt=!1,this.Rt=Ka()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){--this.At}Ft(){this.vt=!0,this.Pt=!0}}class Ua{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=xa,this.qt=Ga(),this.Ut=new pi(Rr)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const n of e.removedTargetIds)this.Qt(n,e.key,e.Tt)}jt(n){this.forEachTarget(n,e=>{const t=this.Wt(e);switch(n.state){case 0:this.zt(e)&&t.Dt(n.resumeToken);break;case 1:t.Mt(),t.Vt||t.xt(),t.Dt(n.resumeToken);break;case 2:t.Mt(),t.Vt||this.removeTarget(e);break;case 3:this.zt(e)&&(t.Ft(),t.Dt(n.resumeToken));break;case 4:this.zt(e)&&(this.Ht(e),t.Dt(n.resumeToken));break;default:vr()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Bt.forEach((e,t)=>{this.zt(t)&&n(t)})}Jt(e){const t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){const e=r.target;if(xi(e))if(0===n){const n=new Ur(e.path);this.Qt(t,n,bi.newNoDocument(n,Fr.min()))}else wr(1===n);else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(r){const s=new Map;this.Bt.forEach((e,t)=>{var n=this.Yt(t);if(n){if(e.current&&xi(n.target)){const s=new Ur(n.target.path);null!==this.Lt.get(s)||this.te(t,s)||this.Qt(t,s,bi.newNoDocument(s,r))}e.St&&(s.set(t,e.Ct()),e.xt())}});let i=La();this.qt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.Yt(e);return!t||2===t.purpose||(n=!1)}),n&&(i=i.add(e))}),this.Lt.forEach((e,t)=>t.setReadTime(r));var e=new Oa(r,s,this.Ut,this.Lt,i);return this.Lt=xa,this.qt=Ga(),this.Ut=new pi(Rr),e}Gt(e,t){var n;this.zt(e)&&(n=this.te(e,t.key)?2:0,this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e)))}Qt(e,t,n){if(this.zt(e)){const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}}removeTarget(e){this.Bt.delete(e)}Xt(e){var t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Ba,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new pi(Rr),this.qt=this.qt.insert(e,t)),t}zt(e){var t=null!==this.Yt(e);return t||gr("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){var t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(t){this.Bt.set(t,new Ba),this.$t.getRemoteKeysForTarget(t).forEach(e=>{this.Qt(t,e,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function Ga(){return new fi(Ur.comparator)}function Ka(){return new fi(Ur.comparator)}const ja={asc:"ASCENDING",desc:"DESCENDING"},$a={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Qa={and:"AND",or:"OR"};class za{constructor(e,t){this.databaseId=e,this.wt=t}}function Wa(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ha(e,t){return e.wt?t.toBase64():t.toUint8Array()}function Ya(e){return wr(!!e),Fr.fromTimestamp((t=Es(e),new Or(t.seconds,t.nanos)));var t}function Xa(e,t){return e=e,new Pr(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Ja(e){var t=Pr.fromString(e);return wr(yo(t)),t}function Za(e,t){return Xa(e.databaseId,t.path)}function eo(e,t){const n=Ja(t);if(n.get(1)!==e.databaseId.projectId)throw new br(Ir.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new br(Ir.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ur(so(n))}function to(e,t){return Xa(e.databaseId,t)}function no(e){var t=Ja(e);return 4===t.length?Pr.emptyPath():so(t)}function ro(e){return new Pr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function so(e){return wr(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function io(e,t,n){return{name:Za(e,t),fields:n.value.mapValue.fields}}function ao(e,t,n){const r=eo(e,t.name),s=Ya(t.updateTime),i=t.createTime?Ya(t.createTime):Fr.min(),a=new Ii({mapValue:{fields:t.fields}}),o=bi.newFoundDocument(r,s,i,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function oo(e,t){let n;if(t instanceof ma)n={update:io(e,t.key,t.value)};else if(t instanceof Ia)n={delete:Za(e,t.key)};else if(t instanceof pa)n={update:io(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof ba))return vr();n={verify:Za(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof Ji)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Zi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof ta)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof ra)return{fieldPath:e.field.canonicalString(),increment:t.gt};throw vr()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,Wa(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:vr()),n;var r}function uo(t,n){const e=n.currentDocument?void 0!==(s=n.currentDocument).updateTime?ua.updateTime(Ya(s.updateTime)):void 0!==s.exists?ua.exists(s.exists):ua.none():ua.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)wr("REQUEST_TIME"===t.setToServerValue),n=new Ji;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Zi(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new ta(e)}else"increment"in t?n=new ra(e,t.increment):vr();var r=Br.fromServerFormat(t.fieldPath);return new aa(r,n)}(t,e)):[];var s;if(n.update){n.update.name;var i=eo(t,n.update.name),a=new Ii({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new wi(e.map(e=>Br.fromServerFormat(e)))}();return new pa(i,a,t,e,r)}return new ma(i,a,e,r)}if(n.delete){const r=eo(t,n.delete);return new Ia(r,e)}if(n.verify){const r=eo(t,n.verify);return new ba(r,e)}return vr()}function co(e,t){return{documents:[to(e,t.path)]}}function ho(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=to(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=to(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s=function(e){if(0!==e.length)return function n(e){return e instanceof Ys?function(e){if("=="===e.op){if(Bs(e.value))return{unaryFilter:{field:mo(e.field),op:"IS_NAN"}};if(qs(e.value))return{unaryFilter:{field:mo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Bs(e.value))return{unaryFilter:{field:mo(e.field),op:"IS_NOT_NAN"}};if(qs(e.value))return{unaryFilter:{field:mo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mo(e.field),op:fo(e.op),value:e.value}}}(e):e instanceof Xs?function(e){const t=e.getFilters().map(e=>n(e));return 1===t.length?t[0]:{compositeFilter:{op:go(e.op),filters:t}}}(e):vr()}(Xs.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:mo(e.field),direction:(e=e.dir,ja[e])}}(e))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);var i,s=(i=t.limit,e.wt||vs(i)?i:{value:i});return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(s=t.startAt).inclusive,values:s.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function lo(e){let t=no(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(0<r){wr(1===r);const g=n.from[0];g.allDescendants?s=g.collectionId:t=t.child(g.collectionId)}let i=[];n.where&&(i=function(){const e=function t(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=po(e.unaryFilter.field);return Ys.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=po(e.unaryFilter.field);return Ys.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=po(e.unaryFilter.field);return Ys.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=po(e.unaryFilter.field);return Ys.create(s,"!=",{nullValue:"NULL_VALUE"});default:return vr()}}(e):void 0!==e.fieldFilter?function(e){return Ys.create(po(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return vr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Xs.create(e.compositeFilter.filters.map(e=>t(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return vr()}}(e.compositeFilter.op))}(e):vr()}(n.where);return e instanceof Xs&&ei(e)?e.getFilters():[e]}());let a=[];n.orderBy&&(a=n.orderBy.map(e=>function(e){return new di(po(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let o=null;var u,c,h,l;n.limit&&(o=(e=n.limit,vs(u="object"==typeof e?e.value:e)?null:u));let d=null;n.startAt&&(d=(c=n.startAt,l=!!c.before,h=c.values||[],new Qs(h,l)));let f=null;return n.endAt&&(f=(c=n.endAt,h=!c.before,l=c.values||[],new Qs(l,h))),ki(t,s,a,i,o,"F",d,f)}function fo(e){return $a[e]}function go(e){return Qa[e]}function mo(e){return{fieldPath:e.canonicalString()}}function po(e){return Br.fromServerFormat(e.fieldPath)}function yo(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function vo(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=wo(t)),t=function(e,t){let n=t;const r=e.length;for(let s=0;s<r;s++){const r=e.charAt(s);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return wo(t)}function wo(e){return e+""}function Io(t){const n=t.length;if(wr(2<=n),2===n)return wr(""===t.charAt(0)&&""===t.charAt(1)),Pr.emptyPath();const r=n-2,s=[];let i="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>r)&&vr(),t.charAt(n+1)){case"":const r=t.substring(a,n);let e;0===i.length?e=r:(i+=r,e=i,i=""),s.push(e);break;case"":i+=t.substring(a,n),i+="\0";break;case"":i+=t.substring(a,n+1);break;default:vr()}a=n+2}return new Pr(s)}const bo=["userId","batchId"];function To(e,t){return[e,vo(t)]}function Eo(e,t,n){return[e,vo(t),n]}const _o={},So=["prefixPath","collectionGroup","readTime","documentId"],xo=["prefixPath","collectionGroup","documentId"],Do=["collectionGroup","readTime","prefixPath","documentId"],Ao=["canonicalId","targetId"],Co=["targetId","path"],No=["path","targetId"],ko=["collectionId","parent"],Ro=["indexId","uid"],Lo=["uid","sequenceNumber"],Mo=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Oo=["indexId","uid","orderedDocumentKey"],Fo=["userId","collectionPath","documentId"],Vo=["userId","collectionPath","largestBatchId"],Po=["userId","collectionGroup","largestBatchId"],qo=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Bo=[...qo,"documentOverlays"],Uo=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Go=Uo,Ko=[...Go,"indexConfiguration","indexState","indexEntries"];class jo extends Jr{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function $o(e,t){var n=e;return ns.M(n.se,t)}class Qo{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&da(s,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=fa(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=fa(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(i,a){const o=Na();return this.mutations.forEach(e=>{const t=i.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var s=la(n,r);null!==s&&o.set(e.key,s),n.isValidDocument()||n.convertToNoDocument(Fr.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),La())}isEqual(e){return this.batchId===e.batchId&&Lr(this.mutations,e.mutations,(e,t)=>ga(e,t))&&Lr(this.baseMutations,e.baseMutations,(e,t)=>ga(e,t))}}class zo{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){wr(e.mutations.length===n.length);let r=ka;var s=e.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new zo(e,t,n,r)}}class Wo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ho{constructor(e,t,n,r,s=Fr.min(),i=Fr.min(),a=bs.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a}withSequenceNumber(e){return new Ho(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Ho(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Ho(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Yo{constructor(e){this.ie=e}}function Xo(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Jo(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:Za(s=e.ie,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:Wa(s,e.version.toTimestamp()),createTime:Wa(s,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Zo(t.version)};else{if(!t.isUnknownDocument())return vr();r.unknownDocument={path:n.path.toArray(),version:Zo(t.version)}}var s;return r}function Jo(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Zo(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function eu(e){var t=new Or(e.seconds,e.nanoseconds);return Fr.fromTimestamp(t)}function tu(t,e){const n=(e.baseMutations||[]).map(e=>uo(t.ie,e));for(let i=0;i<e.mutations.length-1;++i){const n=e.mutations[i];if(i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform){const r=e.mutations[i+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(e=>uo(t.ie,e)),s=Or.fromMillis(e.localWriteTimeMs);return new Qo(e.batchId,s,n,r)}function nu(e){var t,n=eu(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?eu(e.lastLimboFreeSnapshotVersion):Fr.min();let s;return s=void 0!==e.query.documents?(wr(1===(t=e.query).documents.length),Pi(Ri(no(t.documents[0])))):Pi(lo(e.query)),new Ho(s,e.targetId,0,e.lastListenSequenceNumber,n,r,bs.fromBase64String(e.resumeToken))}function ru(e,t){var n=Zo(t.snapshotVersion),r=Zo(t.lastLimboFreeSnapshotVersion),s=(xi(t.target)?co:ho)(e.ie,t.target),i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:_i(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function su(e){var t=lo({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Bi(t,t.limit,"L"):t}function iu(e,t){return new Wo(t.largestBatchId,uo(e.ie,t.overlayMutation))}function au(e,t){var n=t.path.lastSegment();return[e,vo(t.path.popLast()),n]}function ou(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Zo(r.readTime),documentKey:vo(r.documentKey.path),largestBatchId:r.largestBatchId}}class uu{getBundleMetadata(e,t){return cu(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:eu(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return cu(e).put({bundleId:(n=t).id,createTime:Zo(Ya(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return hu(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:su(t.bundledQuery),readTime:eu(t.readTime)};var t})}saveNamedQuery(e,t){return hu(e).put({name:(t=t).name,readTime:Zo(Ya(t.readTime)),bundledQuery:t.bundledQuery})}}function cu(e){return $o(e,"bundles")}function hu(e){return $o(e,"namedQueries")}class lu{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){var n=t.uid||"";return new lu(e,n)}getOverlay(e,t){return du(e).get(au(this.userId,t)).next(e=>e?iu(this.yt,e):null)}getOverlays(e,t){const n=Na();return es.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,s,e){const i=[];return e.forEach((e,t)=>{var n=new Wo(s,t);i.push(this.oe(r,n))}),es.waitFor(i)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(vo(e.getCollectionPath())));const s=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);s.push(du(n).Y("collectionPathOverlayIndex",t))}),es.waitFor(s)}getOverlaysForCollection(e,t,n){const r=Na(),s=vo(t),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return du(e).W("collectionPathOverlayIndex",i).next(e=>{for(const t of e){const e=iu(this.yt,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,s){const i=Na();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return du(e).Z({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=iu(this.yt,t);i.size()<s||r.largestBatchId===a?(i.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>i)}oe(e,t){return du(e).put(function(e,t,n){var[,r,s]=au(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:oo(e.ie,n.mutation)}}(this.yt,this.userId,t))}}function du(e){return $o(e,"documentOverlays")}class fu{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){var n,r;"nullValue"in e?this.he(t,5):"booleanValue"in e?(this.he(t,10),t.le(e.booleanValue?1:0)):"integerValue"in e?(this.he(t,15),t.le(_s(e.integerValue))):"doubleValue"in e?(n=_s(e.doubleValue),isNaN(n)?this.he(t,13):(this.he(t,15),ws(n)?t.le(0):t.le(n))):"timestampValue"in e?(r=e.timestampValue,this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(`${r.seconds||""}`),t.le(r.nanos||0))):"stringValue"in e?(this.de(e.stringValue,t),this._e(t)):"bytesValue"in e?(this.he(t,30),t.we(Ss(e.bytesValue)),this._e(t)):"referenceValue"in e?this.me(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)):"mapValue"in e?Ks(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):vr()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){var n=e.fields||{};this.he(t,55);for(const e of Object.keys(n))this.de(e,t),this.ce(n[e],t)}ye(e,t){var n=e.values||[];this.he(t,50);for(const e of n)this.ce(e,t)}me(e,t){this.he(t,37),Ur.fromName(e).path.forEach(e=>{this.he(t,60),this.pe(e,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function gu(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}fu.Ie=new fu;class mu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ee(n.value),n=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.be(n.value),n=t.next();this.Pe()}ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ee(e);else if(e<2048)this.Ee(960|e>>>6),this.Ee(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e);else{const e=t.codePointAt(0);this.Ee(240|e>>>18),this.Ee(128|63&e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e)}}this.Ae()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.be(e);else if(e<2048)this.be(960|e>>>6),this.be(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.be(480|e>>>12),this.be(128|63&e>>>6),this.be(128|63&e);else{const e=t.codePointAt(0);this.be(240|e>>>18),this.be(128|63&e>>>12),this.be(128|63&e>>>6),this.be(128|63&e)}}this.Pe()}Se(e){var t=this.De(e),n=gu(t);this.Ce(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}xe(e){var t=this.De(e),n=gu(t);this.Ce(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ee(e){var t=255&e;0==t?(this.ke(0),this.ke(255)):255==t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){var t=255&e;0==t?(this.Me(0),this.Me(255)):255==t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class pu{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class yu{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class vu{constructor(){this.$e=new mu,this.Be=new pu(this.$e),this.Le=new yu(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class wu{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new wu(this.indexId,this.documentKey,this.arrayValue,n)}}function Iu(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=bu(e.arrayValue,t.arrayValue),0!==n?n:(n=bu(e.directionalValue,t.directionalValue),0!==n?n:Ur.comparator(e.documentKey,t.documentKey)))}function bu(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class Tu{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const e=t;e.isInequality()?this.Qe=e:this.Ge.push(e)}}je(e){wr(e.collectionGroup===this.collectionId);var t=Kr(e);if(void 0!==t&&!this.We(t))return!1;var n=jr(e);let r=0,s=0;for(;r<n.length&&this.We(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Qe){const e=n[r];if(!this.ze(this.Qe,e)||!this.He(this.Ke[s++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(s>=this.Ke.length||!this.He(this.Ke[s++],e))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Eu(e){if(0===e.getFilters().length)return[];const t=function t(e){if(wr(e instanceof Ys||e instanceof Xs),e instanceof Ys)return e;if(1===e.filters.length)return t(e.filters[0]);const n=e.filters.map(e=>t(e));let r=Xs.create(n,e.op);return r=Cu(r),xu(r)?r:(wr(r instanceof Xs),wr(Js(r)),wr(1<r.filters.length),r.filters.reduce((e,t)=>Du(e,t)))}(function t(n){var e;if(wr(n instanceof Ys||n instanceof Xs),n instanceof Ys){if(n instanceof ci){const r=(null===(e=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===e?void 0:e.map(e=>Ys.create(n.field,"==",e)))||[];return Xs.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return Xs.create(r,n.op)}(e));return wr(xu(t)),_u(t)||Su(t)?[t]:t.getFilters()}function _u(e){return e instanceof Ys}function Su(e){return e instanceof Xs&&ei(e)}function xu(e){return _u(e)||Su(e)||function(e){if(e instanceof Xs&&Zs(e)){for(const t of e.getFilters())if(!_u(t)&&!Su(t))return!1;return!0}return!1}(e)}function Du(e,t){var n,r;return wr(e instanceof Ys||e instanceof Xs),wr(t instanceof Ys||t instanceof Xs),Cu(e instanceof Ys?t instanceof Ys?(n=e,r=t,Xs.create([n,r],"and")):Au(e,t):t instanceof Ys?Au(t,e):function(e,t){if(wr(0<e.filters.length&&0<t.filters.length),Js(e)&&Js(t))return ni(e,t.getFilters());const n=Zs(e)?e:t,r=Zs(e)?t:e,s=n.filters.map(e=>Du(e,r));return Xs.create(s,"or")}(e,t))}function Au(t,e){if(Js(e))return ni(e,t.getFilters());var n=e.filters.map(e=>Du(t,e));return Xs.create(n,"or")}function Cu(t){if(wr(t instanceof Ys||t instanceof Xs),t instanceof Ys)return t;const e=t.getFilters();if(1===e.length)return Cu(e[0]);if(ti(t))return t;const n=e.map(e=>Cu(e)),r=[];return n.forEach(e=>{e instanceof Ys?r.push(e):e instanceof Xs&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:Xs.create(r,t.op)}class Nu{constructor(){this.Je=new ku}addToCollectionParentIndex(e,t){return this.Je.add(t),es.resolve()}getCollectionParents(e,t){return es.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return es.resolve()}deleteFieldIndex(e,t){return es.resolve()}getDocumentsMatchingTarget(e,t){return es.resolve(null)}getIndexType(e,t){return es.resolve(0)}getFieldIndexes(e,t){return es.resolve([])}getNextCollectionGroupToUpdate(e){return es.resolve(null)}getMinOffset(e,t){return es.resolve(Hr.min())}getMinOffsetFromCollectionGroup(e,t){return es.resolve(Hr.min())}updateCollectionGroup(e,t,n){return es.resolve()}updateIndexEntries(e,t){return es.resolve()}}class ku{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new pi(Pr.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new pi(Pr.comparator)).toArray()}}const Ru=new Uint8Array(0);class Lu{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new ku,this.Xe=new Sa(e=>_i(e),(e,t)=>Si(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Ye.has(t))return es.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});r={collectionId:n,parent:vo(r)};return Mu(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Mr(n),""],!1,!0);return Mu(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(Io(t.parent))}return r})}addFieldIndex(e,t){const n=Fu(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const s=n.add(r);if(t.indexState){const n=Vu(e);return s.next(e=>{n.put(ou(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Fu(e),r=Vu(e),s=Ou(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,c){const h=Ou(e);let l=!0;const n=new Map;return es.forEach(this.Ze(c),t=>this.tn(e,t).next(e=>{l=l&&!!e,n.set(t,e)})).next(()=>{if(l){let u=La();const l=[];return es.forEach(n,(e,t)=>{gr("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${_i(c)}`);var n=function(e,t){var n=Kr(t);if(void 0===n)return null;for(const t of Di(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of jr(t))for(const t of Di(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),s=function(e,t){const n=[];let r=!0;for(const s of jr(t)){const t=(0===s.kind?Ai:Ci)(e,s.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new Qs(n,r)}(t,e),i=function(e,t){const n=[];let r=!0;for(const s of jr(t)){const t=(0===s.kind?Ci:Ai)(e,s.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new Qs(n,r)}(t,e),a=this.en(e,t,s),o=this.en(e,t,i),r=this.nn(e,t,r),r=this.sn(e.indexId,n,a,s.inclusive,o,i.inclusive,r);return es.forEach(r,e=>h.J(e,c.limit).next(e=>{e.forEach(e=>{var t=Ur.fromSegments(e.documentKey);u.has(t)||(u=u.add(t),l.push(t))})}))}).next(()=>l)}return es.resolve(null)})}Ze(t){let e=this.Xe.get(t);return e||(e=0===t.filters.length?[t]:Eu(Xs.create(t.filters,"and")).map(e=>Ei(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.Xe.set(t,e),e)}sn(t,e,n,r,s,i,a){const o=(null!=e?e.length:1)*Math.max(n.length,s.length),u=o/(null!=e?e.length:1),c=[];for(let h=0;h<o;++h){const o=e?this.rn(e[h/u]):Ru,l=this.on(t,o,n[h%u],r),d=this.un(t,o,s[h%u],i),f=a.map(e=>this.on(t,o,e,!0));c.push(...this.createRange(l,d,f))}return c}on(e,t,n,r){const s=new wu(e,Ur.empty(),t,n);return r?s:s.Ue()}un(e,t,n,r){const s=new wu(e,Ur.empty(),t,n);return r?s.Ue():s}tn(e,t){const r=new Tu(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.je(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.Ze(t);return es.forEach(r,t=>this.tn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new pi(Br.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}cn(e,t){const n=new vu;for(const s of jr(e)){const e=t.data.field(s.fieldPath);if(null==e)return null;var r=n.qe(s.kind);fu.Ie.ue(e,r)}return n.Fe()}rn(e){const t=new vu;return fu.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const n=new vu;return fu.Ie.ue(Fs(this.databaseId,t),n.qe(0===(r=jr(e)).length?0:r[r.length-1].kind)),n.Fe();var r}nn(e,t,n){if(null===n)return[];let r=[];r.push(new vu);let s=0;for(const i of jr(e)){const e=n[s++];for(const n of r)if(this.hn(t,i.fieldPath)&&Ps(e))r=this.ln(r,i,e);else{const t=n.qe(i.kind);fu.Ie.ue(e,t)}}return this.fn(r)}en(e,t,n){return this.nn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Fe();return t}ln(e,t,n){const r=[...e],s=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new vu;r.seed(n.Fe()),fu.Ie.ue(e,r.qe(t.kind)),s.push(r)}return s}hn(e,t){return!!e.filters.find(e=>e instanceof Ys&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=Fu(e),r=Vu(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const i=[];return es.forEach(e,s=>r.get([s.indexId,this.uid]).next(e=>{var t,n,r;i.push((t=s,n=(e=e)?new Qr(e.sequenceNumber,new Hr(eu(e.readTime),new Ur(Io(e.documentKey)),e.largestBatchId)):Qr.empty(),r=t.fields.map(([e,t])=>new $r(Br.fromServerFormat(e),t)),new Gr(t.indexId,t.collectionGroup,r,n)))})).next(()=>i)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:Rr(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Fu(e),i=Vu(e);return this.dn(e).next(t=>s.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>es.forEach(e,e=>i.put(ou(e.indexId,this.user,t,r)))))}updateIndexEntries(s,e){const n=new Map;return es.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?es.resolve(e):this.getFieldIndexes(s,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),es.forEach(e,n=>this._n(s,t,n).next(e=>{var t=this.wn(r,n);return e.isEqual(t)?es.resolve():this.mn(s,r,n,e,t)}))))})}gn(e,t,n,r){return Ou(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}yn(e,t,n,r){return Ou(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(n,t.key),t.key.path.toArray()])}_n(e,n,r){const t=Ou(e);let s=new pi(Iu);return t.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,n)])},(e,t)=>{s=s.add(new wu(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>s)}wn(e,t){let n=new pi(Iu);var r=this.cn(t,e);if(null==r)return n;const s=Kr(t);if(null!=s){var i=e.data.field(s.fieldPath);if(Ps(i))for(const s of i.arrayValue.values||[])n=n.add(new wu(t.indexId,e.key,this.rn(s),r))}else n=n.add(new wu(t.indexId,e.key,Ru,r));return n}mn(t,n,r,c,e){gr("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const s=[];return function(e,n,r,s){var i=c.getIterator(),a=e.getIterator();let o=vi(i),u=vi(a);for(;o||u;){let e=!1,t=!1;if(o&&u){const r=n(o,u);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(u),u=vi(a)):t?(s(o),o=vi(i)):(o=vi(i),u=vi(a))}}(e,Iu,e=>{s.push(this.gn(t,n,r,e))},e=>{s.push(this.yn(t,n,r,e))}),es.waitFor(s)}dn(e){let r=1;return Vu(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>Iu(e,t)).filter((e,t,n)=>!t||0!==Iu(e,n[t-1]));const r=[];r.push(e);for(const s of n){const n=Iu(s,e),i=Iu(s,t);if(0===n)r[0]=e.Ue();else if(0<n&&i<0)r.push(s),r.push(s.Ue());else if(0<i)break}r.push(t);const s=[];for(let a=0;a<r.length;a+=2){if(this.pn(r[a],r[a+1]))return[];const t=[r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,Ru,[]],n=[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,Ru,[]];s.push(IDBKeyRange.bound(t,n))}return s}pn(e,t){return 0<Iu(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Pu)}getMinOffset(t,e){return es.mapArray(this.Ze(e),e=>this.tn(t,e).next(e=>e||vr())).next(Pu)}}function Mu(e){return $o(e,"collectionParents")}function Ou(e){return $o(e,"indexEntries")}function Fu(e){return $o(e,"indexConfiguration")}function Vu(e){return $o(e,"indexState")}function Pu(e){wr(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let s=1;s<e.length;s++){var r=e[s].indexState.offset;Yr(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new Hr(t.readTime,t.documentKey,n)}const qu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Bu{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Bu(e,Bu.DEFAULT_COLLECTION_PERCENTILE,Bu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Uu(e,t,n){const r=e.store("mutations"),s=e.store("documentMutations"),i=[],a=IDBKeyRange.only(n.batchId);let o=0;const u=r.Z({range:a},(e,t,n)=>(o++,n.delete()));i.push(u.next(()=>{wr(1===o)}));const c=[];for(const e of n.mutations){const r=Eo(t,e.key.path,n.batchId);i.push(s.delete(r)),c.push(e.key)}return es.waitFor(i).next(()=>c)}function Gu(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw vr();t=e.noDocument}return JSON.stringify(t).length}Bu.DEFAULT_COLLECTION_PERCENTILE=10,Bu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bu.DEFAULT=new Bu(41943040,Bu.DEFAULT_COLLECTION_PERCENTILE,Bu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bu.DISABLED=new Bu(-1,0,0);class Ku{constructor(e,t,n,r){this.userId=e,this.yt=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static re(e,t,n,r){wr(""!==e.uid);var s=e.isAuthenticated()?e.uid:"";return new Ku(s,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $u(e).Z({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(h,l,d,f){const g=Qu(h),m=$u(h);return m.add({}).next(e=>{wr("number"==typeof e);const t=new Qo(e,l,d,f),n=(s=this.yt,i=this.userId,a=t,o=a.baseMutations.map(e=>oo(s.ie,e)),u=a.mutations.map(e=>oo(s.ie,e)),{userId:i,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:u}),r=[];var s,i,a,o,u;let c=new pi((e,t)=>Rr(e.canonicalString(),t.canonicalString()));for(const h of f){const l=Eo(this.userId,h.key.path,e);c=c.add(h.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,_o))}return c.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(h,e))}),h.addOnCommittedListener(()=>{this.In[e]=t.keys()}),es.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return $u(e).get(t).next(e=>e?(wr(e.userId===this.userId),tu(this.yt,e)):null)}Tn(e,n){return this.In[n]?es.resolve(this.In[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.In[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return $u(e).Z({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(wr(t.batchId>=r),s=tu(this.yt,t)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return $u(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return $u(e).W("userMutationsIndex",t).next(e=>e.map(e=>tu(this.yt,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=To(this.userId,o.path),t=IDBKeyRange.lowerBound(e),u=[];return Qu(a).Z({range:t},(e,t,n)=>{var[r,s,i]=e,s=Io(s);if(r===this.userId&&o.path.isEqual(s))return $u(a).get(i).next(e=>{if(!e)throw vr();wr(e.userId===this.userId),u.push(tu(this.yt,e))});n.done()}).next(()=>u)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new pi(Rr);const n=[];return e.forEach(a=>{var e=To(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=Qu(t).Z({range:e},(e,t,n)=>{var[r,s,i]=e,s=Io(s);r===this.userId&&a.path.isEqual(s)?o=o.add(i):n.done()});n.push(e)}),es.waitFor(n).next(()=>this.En(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=To(this.userId,a),r=IDBKeyRange.lowerBound(n);let u=new pi(Rr);return Qu(e).Z({range:r},(e,t,n)=>{var[r,s,i]=e,s=Io(s);r===this.userId&&a.isPrefixOf(s)?s.length===o&&(u=u.add(i)):n.done()}).next(()=>this.En(e,u))}En(t,e){const n=[],r=[];return e.forEach(e=>{r.push($u(t).get(e).next(e=>{if(null===e)throw vr();wr(e.userId===this.userId),n.push(tu(this.yt,e))}))}),es.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return Uu(t.se,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.An(n.batchId)}),es.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}An(e){delete this.In[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return es.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return Qu(n).Z({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=Io(e[1]);r.push(t)}else n.done()}).next(()=>{wr(0===r.length)})})}containsKey(e,t){return ju(e,this.userId,t)}Rn(e){return zu(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function ju(e,i,t){const n=To(i,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return Qu(e).Z({range:r,X:!0},(e,t,n)=>{var[r,s]=e;r===i&&s===a&&(o=!0),n.done()}).next(()=>o)}function $u(e){return $o(e,"mutations")}function Qu(e){return $o(e,"documentMutations")}function zu(e){return $o(e,"mutationQueues")}class Wu{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Wu(0)}static vn(){return new Wu(-1)}}class Hu{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(n){return this.Vn(n).next(e=>{const t=new Wu(e.highestTargetId);return e.highestTargetId=t.next(),this.Sn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>Fr.fromTimestamp(new Or(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Vn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Sn(t,e)))}addTargetData(t,n){return this.Dn(t,n).next(()=>this.Vn(t).next(e=>(e.targetCount+=1,this.Cn(n,e),this.Sn(t,e))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Yu(t).delete(e.targetId)).next(()=>this.Vn(t)).next(e=>(wr(0<e.targetCount),--e.targetCount,this.Sn(t,e)))}removeTargets(r,s,i){let a=0;const o=[];return Yu(r).Z((e,t)=>{var n=nu(t);n.sequenceNumber<=s&&null===i.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>es.waitFor(o)).next(()=>a)}forEachTarget(e,r){return Yu(e).Z((e,t)=>{var n=nu(t);r(n)})}Vn(e){return Xu(e).get("targetGlobalKey").next(e=>(wr(null!==e),e))}Sn(e,t){return Xu(e).put("targetGlobalKey",t)}Dn(e,t){return Yu(e).put(ru(this.yt,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,s){var t=_i(s),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return Yu(e).Z({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=nu(t);Si(s,r.target)&&(i=r,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const s=[],i=Ju(n);return e.forEach(e=>{var t=vo(e.path);s.push(i.put({targetId:r,path:t})),s.push(this.referenceDelegate.addReference(n,r,e))}),es.waitFor(s)}removeMatchingKeys(n,e,r){const s=Ju(n);return es.forEach(e,e=>{var t=vo(e.path);return es.waitFor([s.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=Ju(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ju(e);let s=La();return r.Z({range:n,X:!0},(e,t,n)=>{var r=Io(e[1]),r=new Ur(r);s=s.add(r)}).next(()=>s)}containsKey(e,t){var n=vo(t.path),n=IDBKeyRange.bound([n],[Mr(n)],!1,!0);let r=0;return Ju(e).Z({index:"documentTargetsIndex",X:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}ne(e,t){return Yu(e).get(t).next(e=>e?nu(e):null)}}function Yu(e){return $o(e,"targets")}function Xu(e){return $o(e,"targetGlobal")}function Ju(e){return $o(e,"targetDocuments")}function Zu([e,t],[n,r]){var s=Rr(e,n);return 0===s?Rr(t,r):s}class ec{constructor(e){this.xn=e,this.buffer=new pi(Zu),this.Nn=0}kn(){return++this.Nn}On(e){var t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Zu(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class tc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){gr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){is(e)?gr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Zr(e)}await this.Fn(3e5)})}}class nc{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return es.resolve(ds.at);const n=new ec(t);return this.$n.forEachTarget(e,e=>n.On(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.On(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(gr("LruGarbageCollector","Garbage collection skipped; disabled"),es.resolve(qu)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(gr("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qu):this.qn(t,n))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(t,n){let r,s,i,a,o,u,c;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(s=e>this.params.maximumSequenceNumbersToCollect?(gr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,s))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(i=e,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(c=Date.now(),fr()<=l.DEBUG&&gr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-h}ms\n\tDetermined least recently used ${s} in `+(o-a)+"ms\n"+`\tRemoved ${i} targets in `+(u-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-h}ms`),es.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e})))}}class rc{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new nc(e,t))}Bn(e){const n=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Un(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,n){return this.Kn(e,(e,t)=>n(t))}addReference(e,t,n){return sc(e,n)}removeReference(e,t,n){return sc(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return sc(e,t)}Gn(t,n){let r=!1;return zu(t).tt(e=>ju(t,e,n).next(e=>(e&&(r=!0),es.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let a=0;return this.Kn(n,(t,e)=>{if(e<=r){const r=this.Gn(n,t).next(e=>{if(!e)return a++,s.getEntry(n,t).next(()=>(s.removeEntry(t,Fr.min()),Ju(n).delete([0,vo(t.path)])))});i.push(r)}}).next(()=>es.waitFor(i)).next(()=>s.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return sc(e,t)}Kn(e,r){const t=Ju(e);let s,i=ds.at;return t.Z({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(i!==ds.at&&r(new Ur(Io(s)),i),i=n,s=t):i=ds.at}).next(()=>{i!==ds.at&&r(new Ur(Io(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sc(e,t){return Ju(e).put((e=e.currentSequenceNumber,{targetId:0,path:vo(t.path),sequenceNumber:e}))}class ic{constructor(){this.changes=new Sa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,bi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?es.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ac{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return hc(e).put(n)}removeEntry(e,n,t){return hc(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Jo(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Qn(t,e)))}getEntry(e,n){let r=bi.newInvalidDocument(n);return hc(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(lc(n))},(e,t)=>{r=this.jn(n,t)}).next(()=>r)}Wn(e,n){let r={size:0,document:bi.newInvalidDocument(n)};return hc(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(lc(n))},(e,t)=>{r={document:this.jn(n,t),size:Gu(t)}}).next(()=>r)}getEntries(e,t){let r=xa;return this.zn(e,t,(e,t)=>{var n=this.jn(e,t);r=r.insert(e,n)}).next(()=>r)}Hn(e,t){let r=xa,s=new fi(Ur.comparator);return this.zn(e,t,(e,t)=>{var n=this.jn(e,t);r=r.insert(e,n),s=s.insert(e,Gu(t))}).next(()=>({documents:r,Jn:s}))}zn(e,t,s){if(t.isEmpty())return es.resolve();let n=new pi(fc);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(lc(n.first()),lc(n.last())),i=n.getIterator();let a=i.getNext();return hc(e).Z({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=Ur.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&fc(a,r)<0;)s(a,null),a=i.getNext();a&&a.isEqual(r)&&(s(a,t),a=i.hasNext()?i.getNext():null),a?n.j(lc(a)):n.done()}).next(()=>{for(;a;)s(a,null),a=i.hasNext()?i.getNext():null})}getAllFromCollection(e,t,n){var r=[t.popLast().toArray(),t.lastSegment(),Jo(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return hc(e).W(IDBKeyRange.bound(r,s,!0)).next(e=>{let t=xa;for(const n of e){const e=this.jn(Ur.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t})}getAllFromCollectionGroup(e,t,n,s){let i=xa;var r=dc(t,n),a=dc(t,Hr.max());return hc(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.jn(Ur.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(r.key,r),i.size===s&&n.done()}).next(()=>i)}newChangeBuffer(e){return new uc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return cc(e).get("remoteDocumentGlobalKey").next(e=>(wr(!!e),e))}Qn(e,t){return cc(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=ao(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Ur.fromSegments(t.noDocument.path),s=eu(t.noDocument.readTime);n=bi.newNoDocument(e,s),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return vr();{const e=Ur.fromSegments(t.unknownDocument.path),i=eu(t.unknownDocument.version);n=bi.newUnknownDocument(e,i)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new Or(t[0],t[1]),Fr.fromTimestamp(r))),n;var r}(this.yt,t);if(!e.isNoDocument()||!e.version.isEqual(Fr.min()))return e}return bi.newInvalidDocument(e)}}function oc(e){return new ac(e)}class uc extends ic{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Sa(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const a=[];let o=0,u=new pi((e,t)=>Rr(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Xn.get(e);if(a.push(this.Yn.removeEntry(i,e,n.readTime)),t.isValidDocument()){var r=Xo(this.Yn.yt,t);u=u.add(e.path.popLast());var s=Gu(r);o+=s-n.size,a.push(this.Yn.addEntry(i,e,r))}else if(o-=n.size,this.trackRemovals){const o=Xo(this.Yn.yt,t.convertToNoDocument(Fr.min()));a.push(this.Yn.addEntry(i,e,o))}}),u.forEach(e=>{a.push(this.Yn.indexManager.addToCollectionParentIndex(i,e))}),a.push(this.Yn.updateMetadata(i,o)),es.waitFor(a)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:n,Jn:e})=>(e.forEach((e,t)=>{this.Xn.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function cc(e){return $o(e,"remoteDocumentGlobal")}function hc(e){return $o(e,"remoteDocumentsV14")}function lc(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function dc(e,t){const n=t.documentKey.path.toArray();return[e,Jo(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function fc(e,t){var n=e.path.toArray(),r=t.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Rr(n[i],r[i]),s)return s;return s=Rr(n.length,r.length),s||(s=Rr(n[n.length-2],r[r.length-2]),s||Rr(n[n.length-1],r[r.length-1]))}class gc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class mc{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&fa(r.mutation,e,wi.empty(),Or.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,La()).next(()=>e))}getLocalViewOfDocuments(e,t,n=La()){const r=Na();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=Aa();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=Na();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,La()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,s){let i=xa;const a=Na(),o=Na();return t.forEach((e,t)=>{const n=r.get(t.key);s.has(t.key)&&(void 0===n||n.mutation instanceof pa)?i=i.insert(t.key,t):void 0!==n&&(a.set(t.key,n.mutation.getFieldMask()),fa(n.mutation,t,n.mutation.getFieldMask(),Or.now()))}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new gc(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(i,a){const o=Na();let u=new fi((e,t)=>e-t),c=La();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(i,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||wi.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(u.get(r.batchId)||La()).add(e),u=u.insert(r.batchId,t))})}).next(()=>{const e=[],t=u.getReverseIterator();for(;t.hasNext();){const u=t.getNext(),n=u.key,r=u.value,s=Na();r.forEach(e=>{var t;c.has(e)||(null!==(t=la(a.get(e),o.get(e)))&&s.set(e,t),c=c.add(e))}),e.push(this.documentOverlayCache.saveOverlays(i,n,s))}return es.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,Ur.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Fi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(i,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(i,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(i,t,a.largestBatchId,o-n.size):es.resolve(Na());let r=-1,s=n;return e.next(e=>es.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?es.resolve():this.remoteDocumentCache.getEntry(i,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(i,e,n)).next(()=>this.computeViews(i,s,e,La())).next(e=>({batchId:r,changes:Ca(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ur(t)).next(e=>{let t=Aa();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,s,i){const a=s.collectionGroup;let o=Aa();return this.indexManager.getCollectionParents(r,a).next(e=>es.forEach(e,e=>{var t,n=(t=s,e=e.child(a),new Ni(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,i).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,i,n){let a;return this.remoteDocumentCache.getAllFromCollection(t,i.path,n).next(e=>(a=e,this.documentOverlayCache.getOverlaysForCollection(t,i.path,n.largestBatchId))).next(r=>{r.forEach((e,t)=>{var n=t.getKey();null===a.get(n)&&(a=a.insert(n,bi.newInvalidDocument(n)))});let s=Aa();return a.forEach((e,t)=>{var n=r.get(e);void 0!==n&&fa(n.mutation,t,wi.empty(),Or.now()),ji(i,t)&&(s=s.insert(e,t))}),s})}}class pc{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return es.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:Ya(t.createTime)}),es.resolve()}getNamedQuery(e,t){return es.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(t=t).name,query:su(t.bundledQuery),readTime:Ya(t.readTime)}),es.resolve()}}class yc{constructor(){this.overlays=new fi(Ur.comparator),this.es=new Map}getOverlay(e,t){return es.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Na();return es.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.oe(n,r,t)}),es.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),es.resolve()}getOverlaysForCollection(e,t,n){const r=Na(),s=t.length+1,i=new Ur(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return es.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new fi((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Na(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=Na(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return es.resolve(a)}oe(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Wo(t,n));let s=this.es.get(t);void 0===s&&(s=La(),this.es.set(t,s)),this.es.set(t,s.add(n.key))}}class vc{constructor(){this.ns=new pi(wc.ss),this.rs=new pi(wc.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){var n=new wc(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new wc(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){const t=new Ur(new Pr([])),n=new wc(t,e),r=new wc(t,e+1),s=[];return this.rs.forEachInRange([n,r],e=>{this.cs(e),s.push(e.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){var t=new Ur(new Pr([])),n=new wc(t,e),t=new wc(t,e+1);let r=La();return this.rs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new wc(e,0),t=this.ns.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class wc{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return Ur.comparator(e.key,t.key)||Rr(e._s,t._s)}static os(e,t){return Rr(e._s,t._s)||Ur.comparator(e.key,t.key)}}class Ic{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new pi(wc.ss)}checkEmpty(e){return es.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var s=this.ws;this.ws++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var i=new Qo(s,t,n,r);this.mutationQueue.push(i);for(const t of r)this.gs=this.gs.add(new wc(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return es.resolve(i)}lookupMutationBatch(e,t){return es.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.ps(t+1),n=n<0?0:n;return es.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return es.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return es.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new wc(t,0),r=new wc(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([n,r],e=>{var t=this.ys(e._s);s.push(t)}),es.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new pi(Rr);return t.forEach(e=>{var t=new wc(e,0),n=new wc(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,n],e=>{r=r.add(e._s)})}),es.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;Ur.isDocumentKey(s)||(s=s.child(""));var i=new wc(new Ur(s),0);let a=new pi(Rr);return this.gs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e._s)),!0)},i),es.resolve(this.Is(a))}Is(e){const n=[];return e.forEach(e=>{var t=this.ys(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){wr(0===this.Ts(r.batchId,"removed")),this.mutationQueue.shift();let s=this.gs;return es.forEach(r.mutations,e=>{var t=new wc(e.key,r.batchId);return s=s.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.gs=s})}An(e){}containsKey(e,t){var n=new wc(t,0),n=this.gs.firstAfterOrEqual(n);return es.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,es.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){var t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class bc{constructor(e){this.Es=e,this.docs=new fi(Ur.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return es.resolve(n?n.document.mutableCopy():bi.newInvalidDocument(t))}getEntries(e,t){let n=xa;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():bi.newInvalidDocument(e))}),es.resolve(n)}getAllFromCollection(e,t,n){let r=xa;const s=new Ur(t.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:e,value:{document:s}}=i.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Yr(Wr(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return es.resolve(r)}getAllFromCollectionGroup(e,t,n,r){vr()}As(e,t){return es.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Tc(this)}getSize(e){return es.resolve(this.size)}}class Tc extends ic{constructor(e){super(),this.Yn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Yn.addEntry(n,t)):this.Yn.removeEntry(e)}),es.waitFor(r)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Ec{constructor(e){this.persistence=e,this.Rs=new Sa(e=>_i(e),Si),this.lastRemoteSnapshotVersion=Fr.min(),this.highestTargetId=0,this.bs=0,this.Ps=new vc,this.targetCount=0,this.vs=Wu.Pn()}forEachTarget(e,n){return this.Rs.forEach((e,t)=>n(t)),es.resolve()}getLastRemoteSnapshotVersion(e){return es.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return es.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),es.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),es.resolve()}Dn(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new Wu(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,es.resolve()}updateTargetData(e,t){return this.Dn(t),es.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),--this.targetCount,es.resolve()}removeTargets(n,r,s){let i=0;const a=[];return this.Rs.forEach((e,t)=>{t.sequenceNumber<=r&&null===s.get(t.targetId)&&(this.Rs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),i++)}),es.waitFor(a).next(()=>i)}getTargetCount(e){return es.resolve(this.targetCount)}getTargetData(e,t){var n=this.Rs.get(t)||null;return es.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),es.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),es.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),es.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Ps.ds(t);return es.resolve(n)}containsKey(e,t){return es.resolve(this.Ps.containsKey(t))}}class _c{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ds(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Ec(this),this.indexManager=new Nu,this.remoteDocumentCache=(e=e=>this.referenceDelegate.xs(e),new bc(e)),this.yt=new Yo(t),this.Ns=new pc(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new Ic(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){gr("MemoryPersistence","Starting transaction:",e);const r=new Sc(this.Ss.next());return this.referenceDelegate.ks(),n(r).next(e=>this.referenceDelegate.Os(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ms(t,n){return es.or(Object.values(this.Vs).map(e=>()=>e.containsKey(t,n)))}}class Sc extends Jr{constructor(e){super(),this.currentSequenceNumber=e}}class xc{constructor(e){this.persistence=e,this.Fs=new vc,this.$s=null}static Bs(e){return new xc(e)}get Ls(){if(this.$s)return this.$s;throw vr()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),es.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),es.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),es.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Os(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return es.forEach(this.Ls,e=>{const t=Ur.fromPath(e);return this.qs(n,t).next(e=>{e||r.removeEntry(t,Fr.min())})}).next(()=>(this.$s=null,r.apply(n)))}updateLimboDocument(e,t){return this.qs(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return es.or([()=>es.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class Dc{constructor(e){this.yt=e}$(t,e,n,r){const s=new ts("createOrUpgrade",e);var i;n<1&&1<=r&&(t.createObjectStore("owner"),(i=t).createObjectStore("mutationQueues",{keyPath:"userId"}),i.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",bo,{unique:!0}),i.createObjectStore("documentMutations"),Ac(t),t.createObjectStore("remoteDocuments"));let a=es.resolve();return n<3&&3<=r&&(0!==n&&((i=t).deleteObjectStore("targetDocuments"),i.deleteObjectStore("targets"),i.deleteObjectStore("targetGlobal"),Ac(t)),a=a.next(()=>function(){const e=s.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Fr.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,s){return s.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",bo,{unique:!0});const t=s.store("mutations"),n=e.map(e=>t.put(e));return es.waitFor(n)})}(t,s))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Us(s))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ks(s)))),n<7&&7<=r&&(a=a.next(()=>this.Gs(s))),n<8&&8<=r&&(a=a.next(()=>this.Qs(t,s))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.js(s))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:Fo});e.createIndex("collectionPathOverlayIndex",Vo,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",Po,{unique:!1})}()})),n<13&&13<=r&&(a=a.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:So});e.createIndex("documentKeyIndex",xo),e.createIndex("collectionGroupIndex",Do)}()).next(()=>this.Ws(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.zs(t,s))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ro}).createIndex("sequenceNumberIndex",Lo,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Mo}).createIndex("documentKeyIndex",Oo,{unique:!1})}(t))),a}Ks(t){let n=0;return t.store("remoteDocuments").Z((e,t)=>{n+=Gu(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Us(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.W().next(e=>es.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.W("userMutationsIndex",e).next(e=>es.forEach(e,e=>{wr(e.userId===n.userId);var t=tu(this.yt,e);return Uu(r,n.userId,t).next(()=>{})}))}))}Gs(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return t.Z((e,t)=>{const n=new Pr(e),r=[0,vo(n)];i.push(a.get(r).next(e=>e?es.resolve():(e=>a.put({targetId:0,path:vo(e),sequenceNumber:s.highestListenSequenceNumber}))(n)))}).next(()=>es.waitFor(i))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:ko});const n=t.store("collectionParents"),r=new ku,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:vo(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>{const n=new Pr(e);return s(n.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([,e],t)=>{const n=Io(e);return s(n.popLast())}))}js(e){const r=e.store("targets");return r.Z((e,t)=>{var n=nu(t),n=ru(this.yt,n);return r.put(n)})}Ws(e,i){const t=i.store("remoteDocuments"),a=[];return t.Z((e,t)=>{const n=i.store("remoteDocumentsV14"),r=((s=t).document?new Ur(Pr.fromString(s.document.name).popFirst(5)):s.noDocument?Ur.fromSegments(s.noDocument.path):s.unknownDocument?Ur.fromSegments(s.unknownDocument.path):vr()).path.toArray();var s={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(s))}).next(()=>es.waitFor(a))}zs(e,i){const t=i.store("mutations"),a=oc(this.yt),o=new _c(xc.Bs,this.yt.ie);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:La();tu(this.yt,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),es.forEach(r,(e,t)=>{var n=new hr(t),r=lu.re(this.yt,n),s=o.getIndexManager(n),n=Ku.re(n,this.yt,s,o.referenceDelegate);return new mc(a,n,r,s).recalculateAndSaveOverlaysForDocumentKeys(new jo(i,ds.at),e).next()})})}}function Ac(e){e.createObjectStore("targetDocuments",{keyPath:Co}).createIndex("documentTargetsIndex",No,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ao,{unique:!0}),e.createObjectStore("targetGlobal")}const Cc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Nc{constructor(e,t,n,r,s,i,a,o,u,c,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=s,this.window=i,this.document=a,this.Js=u,this.Ys=c,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!Nc.C())throw new br(Ir.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new rc(this,r),this.ii=t+"main",this.yt=new Yo(o),this.ri=new ns(this.ii,this.Xs,new Dc(this.yt)),this.Cs=new Hu(this.referenceDelegate,this.yt),this.remoteDocumentCache=oc(this.yt),this.Ns=new uu,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===c&&mr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new br(Ir.FAILED_PRECONDITION,Cc);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ds(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(t){return this.si=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ri.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Rc(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(t)).next(e=>this.isPrimary&&!e?this._i(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(e=>{if(is(e))return gr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return gr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return kc(e).get("owner").next(e=>es.resolve(this.mi(e)))}gi(e){return Rc(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=$o(e,"clientMetadata");return r.W().next(e=>{const t=this.Ii(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return es.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(t){return this.Ys?es.resolve(!0):kc(t).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)){if(this.mi(e)&&this.networkEnabled)return!0;if(!this.mi(e)){if(!e.allowTabSynchronization)throw new br(Ir.FAILED_PRECONDITION,Cc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rc(t).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&gr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new jo(e,ds.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Rc(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Ku.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Lu(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return lu.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(t,n,r){gr("IndexedDbPersistence","Starting transaction:",t);var e,s="readonly"===n?"readonly":"readwrite",e=15===(e=this.Xs)?Ko:14===e?Go:13===e?Uo:12===e?Bo:11===e?qo:void vr();let i;return this.ri.runTransaction(t,s,e,e=>(i=new jo(e,this.Ss?this.Ss.next():ds.at),"readwrite-primary"===n?this.fi(i).next(e=>!!e||this.di(i)).next(e=>{if(!e)throw mr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new br(Ir.FAILED_PRECONDITION,Xr);return r(i)}).next(e=>this.wi(i).next(()=>e)):this.Vi(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Vi(e){return kc(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new br(Ir.FAILED_PRECONDITION,Cc)})}wi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return kc(e).put("owner",t)}static C(){return ns.C()}_i(e){const t=kc(e);return t.get("owner").next(e=>this.mi(e)?(gr("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):es.resolve())}pi(e,t){var n=Date.now();return!(e<n-t||n<e&&(mr(`Detected an update time that is in the future: ${e} > ${n}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),s()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{var n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return gr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return mr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){mr("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function kc(e){return $o(e,"owner")}function Rc(e){return $o(e,"clientMetadata")}function Lc(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Mc{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=La(),r=La();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Mc(e,t.fromCache,n,r)}}class Oc{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(t,n,r,s){return this.ki(t,n).next(e=>e||this.Oi(t,n,s,r)).next(e=>e||this.Mi(t,n))}ki(s,i){if(Li(i))return es.resolve(null);let t=Pi(i);return this.indexManager.getIndexType(s,t).next(e=>0===e?null:(null!==i.limit&&1===e&&(i=Bi(i,null,"F"),t=Pi(i)),this.indexManager.getDocumentsMatchingTarget(s,t).next(e=>{const r=La(...e);return this.Ni.getDocuments(s,r).next(n=>this.indexManager.getMinOffset(s,t).next(e=>{var t=this.Fi(i,n);return this.$i(i,t,r,e.readTime)?this.ki(s,Bi(i,null,"F")):this.Bi(s,t,i,e)}))})))}Oi(n,r,s,i){return Li(r)||i.isEqual(Fr.min())?this.Mi(n,r):this.Ni.getDocuments(n,s).next(e=>{var t=this.Fi(r,e);return this.$i(r,t,s,i)?this.Mi(n,r):(fr()<=l.DEBUG&&gr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ki(r)),this.Bi(n,t,r,zr(i,-1)))})}Fi(n,e){let r=new pi(Qi(n));return e.forEach((e,t)=>{ji(n,t)&&(r=r.add(t))}),r}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||0<s.version.compareTo(r))}Mi(e,t){return fr()<=l.DEBUG&&gr("QueryEngine","Using full collection scan to execute query:",Ki(t)),this.Ni.getDocumentsMatchingQuery(e,t,Hr.min())}Bi(e,n,t,r){return this.Ni.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class Fc{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new fi(Rr),this.Ui=new Sa(e=>_i(e),Si),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mc(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.qi))}}function Vc(e,t,n,r){return new Fc(e,t,n,r)}async function Pc(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",s=>{let i;return a.mutationQueue.getAllMutationBatches(s).next(e=>(i=e,a.Qi(t),a.mutationQueue.getAllMutationBatches(s))).next(e=>{const t=[],n=[];let r=La();for(const s of i){t.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}for(const s of e){n.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(s,r).next(e=>({ji:e,removedBatchIds:t,addedBatchIds:n}))})})}function qc(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Cs.getLastRemoteSnapshotVersion(e))}function Bc(e,c){const h=e,l=c.snapshotVersion;let d=h.qi;return h.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=h.Gi.newChangeBuffer({trackRemovals:!0});d=h.qi;const u=[];c.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){u.push(h.Cs.removeMatchingKeys(o,t.removedDocuments,n).next(()=>h.Cs.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var s,i,a;c.targetMismatches.has(n)?e=e.withResumeToken(bs.EMPTY_BYTE_STRING,Fr.min()).withLastLimboFreeSnapshotVersion(Fr.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),d=d.insert(n,e),s=r,i=e,a=t,0!==s.resumeToken.approximateByteSize()&&!(3e8<=i.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||u.push(h.Cs.updateTargetData(o,e))}});let t=xa,n=La();if(c.documentUpdates.forEach(e=>{c.resolvedLimboDocuments.has(e)&&u.push(h.persistence.referenceDelegate.updateLimboDocument(o,e))}),u.push(Uc(o,e,c.documentUpdates).next(e=>{t=e.Wi,n=e.zi})),!l.isEqual(Fr.min())){const c=h.Cs.getLastRemoteSnapshotVersion(o).next(e=>h.Cs.setTargetsMetadata(o,o.currentSequenceNumber,l));u.push(c)}return es.waitFor(u).next(()=>e.apply(o)).next(()=>h.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(h.qi=d,e))}function Uc(e,i,t){let n=La(),a=La();return t.forEach(e=>n=n.add(e)),i.getEntries(e,n).next(r=>{let s=xa;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(Fr.min())?(i.removeEntry(e,t.readTime),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(i.addEntry(t),s=s.insert(e,t)):gr("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Wi:s,zi:a}})}function Gc(e,r){const s=e;return s.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return s.Cs.getTargetData(t,r).next(e=>e?(n=e,es.resolve(n)):s.Cs.allocateTargetId(t).next(e=>(n=new Ho(r,e,0,t.currentSequenceNumber),s.Cs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=s.qi.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(s.qi=s.qi.insert(e.targetId,e),s.Ui.set(r,e.targetId)),e})}async function Kc(e,t,n){const r=e,s=r.qi.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!is(e))throw e;gr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qi=r.qi.remove(t),r.Ui.delete(s.target)}function jc(e,n,r){const s=e;let i=Fr.min(),a=La();return s.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,s=r.Ui.get(n);return void 0!==s?es.resolve(r.qi.get(s)):r.Cs.getTargetData(t,n)}(s,t,Pi(n)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Cs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>s.Li.getDocumentsMatchingQuery(t,n,r?i:Fr.min(),r?a:La())).next(e=>(zc(s,$i(n),e),{documents:e,Hi:a})))}function $c(e,t){const n=e,r=n.Cs,s=n.qi.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",e=>r.ne(e,t).next(e=>e?e.target:null))}function Qc(e,t){const n=e,r=n.Ki.get(t)||Fr.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Gi.getAllFromCollectionGroup(e,t,zr(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(zc(n,t,e),e))}function zc(e,t,n){let r=e.Ki.get(t)||Fr.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Ki.set(t,r)}function Wc(e,t){return`firestore_clients_${e}_${t}`}function Hc(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Yc(e,t){return`firestore_targets_${e}_${t}`}class Xc{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){var r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new br(r.error.code,r.error.message))),i?new Xc(e,t,r.state,s):(mr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Jc{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){var n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new br(n.error.code,n.error.message))),s?new Jc(e,n.state,r):(mr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Ma;for(let i=0;r&&i<n.activeTargetIds.length;++i)r=Is(n.activeTargetIds[i]),s=s.add(n.activeTargetIds[i]);return r?new Zc(e,s):(mr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class eh{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new eh(t.clientId,t.onlineState):(mr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class th{constructor(){this.activeTargetIds=Ma}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class nh{constructor(e,t,n,r,s){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new fi(Rr),this.started=!1,this.cr=[];var i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=Wc(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new th),this.lr=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const n of e)if(n!==this.sr){const e=this.getItem(Wc(this.persistenceKey,n));var t;!e||(t=Zc.Zi(n,e))&&(this.ur=this.ur.insert(t.clientId,t))}this.gr();const n=this.storage.getItem(this.wr);if(n){const e=this.yr(n);e&&this.pr(e)}for(const e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(n){let r=!1;return this.ur.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(Yc(this.persistenceKey,e)))||(n=Jc.Zi(e,n))&&(t=n.state)),this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Yc(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Er(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return gr("SharedClientState","READ",e,t),t}setItem(e,t){gr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){gr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const s=e;s.storageArea===this.storage&&(gr("SharedClientState","EVENT",s.key,s.newValue),s.key!==this.ar?this.Hs.enqueueRetryable(async()=>{if(this.started){if(null!==s.key)if(this.lr.test(s.key)){if(null==s.newValue){var e=this.vr(s.key);return this.Vr(e,null)}e=this.Sr(s.key,s.newValue);if(e)return this.Vr(e.clientId,e)}else if(this.dr.test(s.key)){if(null!==s.newValue){var t=this.Dr(s.key,s.newValue);if(t)return this.Cr(t)}}else if(this._r.test(s.key)){if(null!==s.newValue){t=this.Nr(s.key,s.newValue);if(t)return this.kr(t)}}else if(s.key===this.wr){if(null!==s.newValue){var n=this.yr(s.newValue);if(n)return this.pr(n)}}else if(s.key===this.hr){n=function(e){let t=ds.at;if(null!=e)try{var n=JSON.parse(e);wr("number"==typeof n),t=n}catch(e){mr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(s.newValue);n!==ds.at&&this.sequenceNumberHandler(n)}else if(s.key===this.mr){const r=this.Or(s.newValue);await Promise.all(r.map(e=>this.syncEngine.Mr(e)))}}else this.cr.push(s)}):mr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new Xc(this.currentUser,e,t,n),s=Hc(this.persistenceKey,this.currentUser,e);this.setItem(s,r.tr())}Er(e){var t=Hc(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){var t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,n){const r=Yc(this.persistenceKey,e),s=new Jc(e,t,n);this.setItem(r,s.tr())}Pr(e){var t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){var t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){var n=this.vr(e);return Zc.Zi(n,t)}Dr(e,t){var n=this.dr.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Xc.Zi(new hr(n),r,t)}Nr(e,t){var n=this._r.exec(e),n=Number(n[1]);return Jc.Zi(n,t)}yr(e){return eh.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);gr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),s=this.Ir(n),i=[],a=[];return s.forEach(e=>{r.has(e)||i.push(e)}),r.forEach(e=>{s.has(e)||a.push(e)}),this.syncEngine.Br(i,a).then(()=>{this.ur=n})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let n=Ma;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class rh{constructor(){this.Lr=new th,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new th,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sh{Ur(e){}shutdown(){}}class ih{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){gr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){gr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const ah={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class oh{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class uh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(t,e,n,r,s){const i=this.ho(t,e);gr("RestConnection","Sending: ",i,n);var a={};return this.lo(a,r,s),this.fo(t,i,a,n).then(e=>(gr("RestConnection","Received: ",e),e),e=>{throw pr("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}_o(e,t,n,r,s,i){return this.ao(e,t,n,r,s)}lo(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+lr,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}ho(e,t){var n=ah[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(o,t,n,r){return new Promise((s,i)=>{const a=new ur;a.setWithCredentials(!0),a.listenOnce(nr.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case tr.NO_ERROR:var e=a.getResponseJson();gr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case tr.TIMEOUT:gr("Connection",'RPC "'+o+'" timed out'),i(new br(Ir.DEADLINE_EXCEEDED,"Request time out"));break;case tr.HTTP_ERROR:var t=a.getStatus();if(gr("Connection",'RPC "'+o+'" failed with status:',t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);var n=null==e?void 0:e.error;if(n&&n.status&&n.message){const o=(r=n.status.toLowerCase().replace(/_/g,"-"),0<=Object.values(Ir).indexOf(r)?r:Ir.UNKNOWN);i(new br(o,n.message))}else i(new br(Ir.UNKNOWN,"Server responded with status "+a.getStatus()))}else i(new br(Ir.UNAVAILABLE,"Connection failed."));break;default:vr()}}finally{gr("Connection",'RPC "'+o+'" completed.')}var r});var e=JSON.stringify(r);a.send(t,"POST",e,n,15)})}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new Wn,i=er(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new ar({})),this.lo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;var o=r.join("");gr("Connection","Creating WebChannel: "+o,a);const u=s.createWebChannel(o,a);let c=!1,h=!1;const l=new oh({Hr:e=>{h?gr("Connection","Not sending because WebChannel is closed:",e):(c||(gr("Connection","Opening WebChannel transport."),u.open(),c=!0),gr("Connection","WebChannel sending:",e),u.send(e))},Jr:()=>u.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(u,or.EventType.OPEN,()=>{h||gr("Connection","WebChannel transport opened.")}),d(u,or.EventType.CLOSE,()=>{h||(h=!0,gr("Connection","WebChannel transport closed"),l.io())}),d(u,or.EventType.ERROR,e=>{h||(h=!0,pr("Connection","WebChannel transport errored:",e),l.io(new br(Ir.UNAVAILABLE,"The operation could not be completed")))}),d(u,or.EventType.MESSAGE,n=>{if(!h){var e=n.data[0];wr(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){gr("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){var t=Zn[e];if(void 0!==t)return _a(t)}(n),t=r.message;void 0===e&&(e=Ir.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),h=!0,l.io(new br(e,t)),u.close()}else gr("Connection","WebChannel received:",e),l.ro(e)}}),d(i,rr.STAT_EVENT,e=>{e.stat===sr?gr("Connection","Detected buffering proxy"):e.stat===ir&&gr("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.so()},0),l}}function ch(){return"undefined"!=typeof window?window:null}function hh(){return"undefined"!=typeof document?document:null}function lh(e){return new za(e,!0)}class dh{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();var t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);0<r&&gr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class fh{constructor(e,t,n,r,s,i,a,o){this.Hs=e,this.vo=n,this.Vo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new dh(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===Ir.RESOURCE_EXHAUSTED?(mr(t.toString()),mr("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===Ir.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.So===n&&this.Go(e,t)},t=>{e(()=>{var e=new br(Ir.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return gr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(t){return e=>{this.Hs.enqueueAndForget(()=>this.So===t?e():(gr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gh extends fh{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:vr(),s=t.targetChange.targetIds||[],i=(f=t.targetChange.resumeToken,e.wt?(wr(void 0===f||"string"==typeof f),bs.fromBase64String(f||"")):(wr(void 0===f||f instanceof Uint8Array),bs.fromUint8Array(f||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(f=a).code?Ir.UNKNOWN:_a(f.code),new br(o,f.message||""));n=new qa(r,s,i,o||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var i=eo(e,u.document.name),o=Ya(u.document.updateTime),c=u.document.createTime?Ya(u.document.createTime):Fr.min(),h=new Ii({mapValue:{fields:u.document.fields}}),c=bi.newFoundDocument(i,o,c,h),h=u.targetIds||[],u=u.removedTargetIds||[];n=new Va(h,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;h=t.documentDelete;h.document;u=eo(e,h.document),c=h.readTime?Ya(h.readTime):Fr.min(),c=bi.newNoDocument(u,c),h=h.removedTargetIds||[];n=new Va([],h,c.key,c)}else if("documentRemove"in t){t.documentRemove;var l=t.documentRemove;l.document;var d=eo(e,l.document),l=l.removedTargetIds||[];n=new Va([],l,d,null)}else{if(!("filter"in t))return vr();{t.filter;const e=t.filter;e.targetId;l=e.count||0,d=new Ta(l),l=e.targetId;n=new Pa(l,d)}}var o,f;return n}(this.yt,e),n=function(e){if(!("targetChange"in e))return Fr.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?Ya(t.readTime):Fr.min()}(e);return this.listener.Wo(t,n)}zo(e){const t={};t.database=ro(this.yt),t.addTarget=function(e,t){let n;var r=t.target;return n=xi(r)?{documents:co(e,r)}:{query:ho(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=Ha(e,t.resumeToken):0<t.snapshotVersion.compareTo(Fr.min())&&(n.readTime=Wa(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);var n,r,r=(this.yt,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return vr()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=ro(this.yt),t.removeTarget=e,this.Bo(t)}}class mh extends fh{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(wr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();var t=(r=e.writeResults,s=e.commitTime,r&&0<r.length?(wr(void 0!==s),r.map(e=>function(e,t){let n=e.updateTime?Ya(e.updateTime):Ya(t);return n.isEqual(Fr.min())&&(n=Ya(t)),new oa(n,e.transformResults||[])}(e,s))):[]),n=Ya(e.commitTime);return this.listener.Zo(n,t)}var r,s;return wr(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=ro(this.yt),this.Bo(e)}Xo(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>oo(this.yt,e))};this.Bo(t)}}class ph extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=r,this.nu=!1}su(){if(this.nu)throw new br(Ir.FAILED_PRECONDITION,"The client has already been terminated.")}ao(n,r,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.ao(n,r,s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ir.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new br(Ir.UNKNOWN,e.toString())})}_o(n,r,s,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection._o(n,r,s,e,t,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ir.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new br(Ir.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class yh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,1<=this.iu&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(mr(t),this.ou=!1):gr("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class vh{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(e=>{n.enqueueAndForget(async()=>{Dh(this)&&(gr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t._u.add(4),await Ih(t),t.gu.set("Unknown"),t._u.delete(4),await wh(t)}(this))})}),this.gu=new yh(n,r)}}async function wh(e){if(Dh(e))for(const t of e.wu)await t(!0)}async function Ih(e){for(const t of e.wu)await t(!1)}function bh(e,t){const n=e;n.du.has(t.targetId)||(n.du.set(t.targetId,t),xh(n)?Sh(n):Fh(n).ko()&&Eh(n,t))}function Th(e,t){const n=e,r=Fh(n);n.du.delete(t),r.ko()&&_h(n,t),0===n.du.size&&(r.ko()?r.Fo():Dh(n)&&n.gu.set("Unknown"))}function Eh(e,t){e.yu.Ot(t.targetId),Fh(e).zo(t)}function _h(e,t){e.yu.Ot(t),Fh(e).Ho(t)}function Sh(t){t.yu=new Ua({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>t.du.get(e)||null}),Fh(t).start(),t.gu.uu()}function xh(e){return Dh(e)&&!Fh(e).No()&&0<e.du.size}function Dh(e){return 0===e._u.size}function Ah(e){e.yu=void 0}async function Ch(e,t,n){if(!is(t))throw t;e._u.add(1),await Ih(e),e.gu.set("Offline"),n=n||(()=>qc(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{gr("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await wh(e)})}function Nh(t,n){return n().catch(e=>Ch(t,e,n))}async function kh(e){const t=e,n=Vh(t);let r=0<t.fu.length?t.fu[t.fu.length-1].batchId:-1;for(;Dh(s=t)&&s.fu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId,function(e,t){e.fu.push(t);const n=Vh(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}(t,e)}catch(e){await Ch(t,e)}var s;Rh(t)&&Lh(t)}function Rh(e){return Dh(e)&&!Vh(e).No()&&0<e.fu.length}function Lh(e){Vh(e).start()}async function Mh(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),gr("RemoteStore","RemoteStore received new credentials");var r=Dh(n);n._u.add(3),await Ih(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await wh(n)}async function Oh(e,t){const n=e;t?(n._u.delete(2),await wh(n)):(n._u.add(2),await Ih(n),n.gu.set("Unknown"))}function Fh(t){return t.pu||(t.pu=function(e,t,n){const r=e;return r.su(),new gh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(t.datastore,t.asyncQueue,{Yr:(async function(n){n.du.forEach((e,t)=>{Eh(n,e)})}).bind(null,t),Zr:(async function(e,t){Ah(e),xh(e)?(e.gu.hu(t),Sh(e)):e.gu.set("Unknown")}).bind(null,t),Wo:(async function(e,r,t){if(e.gu.set("Online"),r instanceof qa&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.du.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.du.delete(n),e.yu.removeTarget(n))}(e)}catch(t){gr("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await Ch(e,t)}else if(r instanceof Va?e.yu.Kt(r):r instanceof Pa?e.yu.Jt(r):e.yu.jt(r),!t.isEqual(Fr.min()))try{const r=await qc(e.localStore);0<=t.compareTo(r)&&await function(r,s){const e=r.yu.Zt(s);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.du.get(t);n&&r.du.set(t,n.withResumeToken(e.resumeToken,s))}}),e.targetMismatches.forEach(e=>{const t=r.du.get(e);var n;t&&(r.du.set(e,t.withResumeToken(bs.EMPTY_BYTE_STRING,t.snapshotVersion)),_h(r,e),n=new Ho(t.target,e,1,t.sequenceNumber),Eh(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){gr("RemoteStore","Failed to raise snapshot:",r),await Ch(e,r)}}).bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Mo(),xh(t)?Sh(t):t.gu.set("Unknown")):(await t.pu.stop(),Ah(t))})),t.pu}function Vh(t){return t.Iu||(t.Iu=function(e,t,n){const r=e;return r.su(),new mh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(t.datastore,t.asyncQueue,{Yr:(async function(e){Vh(e).eu()}).bind(null,t),Zr:(async function(e,t){t&&Vh(e).Yo&&await async function(e,t){if(Ea(n=t.code)&&n!==Ir.ABORTED){const n=e.fu.shift();Vh(e).Mo(),await Nh(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await kh(e)}var n}(e,t),Rh(e)&&Lh(e)}).bind(null,t),tu:(async function(e){const t=Vh(e);for(const n of e.fu)t.Xo(n.mutations)}).bind(null,t),Zo:(async function(e,t,n){const r=e.fu.shift(),s=zo.from(r,t,n);await Nh(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await kh(e)}).bind(null,t)}),t.wu.push(async e=>{e?(t.Iu.Mo(),await kh(t)):(await t.Iu.stop(),0<t.fu.length&&(gr("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))})),t.Iu}class Ph{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Tr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,a=new Ph(e,t,i,r,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new br(Ir.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qh(e,t){if(mr("AsyncQueue",`${t}: ${e}`),is(e))return new br(Ir.UNAVAILABLE,`${t}: ${e}`);throw e}class Bh{constructor(n){this.comparator=n?(e,t)=>n(e,t)||Ur.comparator(e.key,t.key):(e,t)=>Ur.comparator(e.key,t.key),this.keyedMap=Aa(),this.sortedSet=new fi(this.comparator)}static emptySet(e){return new Bh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Bh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new Bh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Uh{constructor(){this.Tu=new fi(Ur.comparator)}track(e){var t=e.doc.key,n=this.Tu.get(t);!n||0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):vr()}Eu(){const n=[];return this.Tu.inorderTraversal((e,t)=>{n.push(t)}),n}}class Gh{constructor(e,t,n,r,s,i,a,o,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Gh(e,t,Bh.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ui(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Kh{constructor(){this.Au=void 0,this.listeners=[]}}class jh{constructor(){this.queries=new Sa(e=>Gi(e),Ui),this.onlineState="Unknown",this.Ru=new Set}}async function $h(e,t){const n=e,r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Kh),s)try{i.Au=await n.onListen(r)}catch(e){const n=qh(e,`Initialization of query '${Ki(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.bu(n.onlineState),!i.Au||t.Pu(i.Au)&&zh(n)}async function Qh(e,t){const n=e,r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);0<=e&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function zh(e){e.Ru.forEach(e=>{e.next()})}class Wh{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Gh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(0<e.docChanges.length)return!0;var t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=Gh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Hh{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Yh{constructor(e){this.yt=e}Ji(e){return eo(this.yt,e)}Yi(e){return e.metadata.exists?ao(this.yt,e.document,!1):bi.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Ya(e)}}class Xh{constructor(e,t,n){this.Mu=e,this.localStore=t,this.yt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Jh(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const n=Pr.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new Yh(this.yt);for(const s of e)if(s.metadata.queries){const e=n.Ji(s.metadata.name);for(const n of s.metadata.queries){var r=(t.get(n)||La()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=e;let i=La(),a=xa;for(const e of n){const n=t.Ji(e.metadata.name);e.document&&(i=i.add(n));const c=t.Yi(e);c.setReadTime(t.Xi(e.metadata.readTime)),a=a.insert(n,c)}const o=s.Gi.newChangeBuffer({trackRemovals:!0}),u=await Gc(s,(r=r,Pi(Ri(Pr.fromString(`__bundle__/docs/${r}`)))));return s.persistence.runTransaction("Apply bundle documents","readwrite",t=>Uc(t,o,a).next(e=>(o.apply(t),e)).next(e=>s.Cs.removeMatchingKeysForTargetId(t,u.targetId).next(()=>s.Cs.addMatchingKeys(t,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(t,e.Wi,e.zi)).next(()=>e.Wi)))}(this.localStore,new Yh(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const e of this.queries)await async function(e,n,r=La()){const s=await Gc(e,Pi(su(n.bundledQuery))),i=e;return i.persistence.runTransaction("Save named query","readwrite",e=>{var t=Ya(n.readTime);if(0<=s.snapshotVersion.compareTo(t))return i.Ns.saveNamedQuery(e,n);t=s.withResumeToken(bs.EMPTY_BYTE_STRING,t);return i.qi=i.qi.insert(t.targetId,t),i.Cs.updateTargetData(e,t).next(()=>i.Cs.removeMatchingKeysForTargetId(e,s.targetId)).next(()=>i.Cs.addMatchingKeys(e,r,s.targetId)).next(()=>i.Ns.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function Jh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Zh{constructor(e){this.key=e}}class el{constructor(e){this.key=e}}class tl{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=La(),this.mutatedKeys=La(),this.Gu=Qi(e),this.Qu=new Bh(this.Gu)}get ju(){return this.qu}Wu(e,t){const o=t?t.zu:new Uh,u=(t||this).Qu;let c=(t||this).mutatedKeys,h=u,l=!1;const d="F"===this.query.limitType&&u.size===this.query.limit?u.last():null,f="L"===this.query.limitType&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((e,t)=>{const n=u.get(e),r=ji(this.query,t)?t:null,s=!!n&&this.mutatedKeys.has(n.key),i=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?s!==i&&(o.track({type:3,doc:r}),a=!0):this.Hu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Gu(r,d)||f&&this.Gu(r,f)<0)&&(l=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||f)&&(l=!0)),a&&(c=r?(h=h.add(r),i?c.add(e):c.delete(e)):(h=h.delete(e),c.delete(e)))}),null!==this.query.limit)for(;h.size>this.query.limit;){const e="F"===this.query.limitType?h.last():h.first();h=h.delete(e.key),c=c.delete(e.key),o.track({type:1,doc:e})}return{Qu:h,zu:o,$i:l,mutatedKeys:c}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return vr()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc)),this.Ju(n);var i=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,o=a!==this.Uu;return this.Uu=a,0!==s.length||o?{snapshot:new Gh(this.query,e.Qu,r,s,e.mutatedKeys,0==a,o,!1,!!n&&0<n.resumeToken.approximateByteSize()),Xu:i}:{Xu:i}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Uh,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(e=>this.qu=this.qu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qu=this.qu.delete(e)),this.current=e.current)}Yu(){if(!this.current)return[];const t=this.Ku;this.Ku=La(),this.Qu.forEach(e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))});const n=[];return t.forEach(e=>{this.Ku.has(e)||n.push(new el(e))}),this.Ku.forEach(e=>{t.has(e)||n.push(new Zh(e))}),n}tc(e){this.qu=e.Hi,this.Ku=La();var t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Gh.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class nl{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class rl{constructor(e){this.key=e,this.nc=!1}}class sl{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.sc={},this.ic=new Sa(e=>Gi(e),Ui),this.rc=new Map,this.oc=new Set,this.uc=new fi(Ur.comparator),this.cc=new Map,this.ac=new vc,this.hc={},this.lc=new Map,this.fc=Wu.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function il(n,e,t,r,s){n._c=(e,i,t)=>async function(e,t,n){let r=t.view.Wu(i);r.$i&&(r=await jc(e.localStore,t.query,!1).then(({documents:e})=>t.view.Wu(e,r)));var s=n&&n.targetChanges.get(t.targetId),s=t.view.applyChanges(r,e.isPrimaryClient,s);return gl(e,t.targetId,s.Xu),s.snapshot}(n,e,t);const i=await jc(n.localStore,e,!0),a=new tl(e,i.Hi),o=a.Wu(i.documents),u=Fa.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,s),c=a.applyChanges(o,n.isPrimaryClient,u);gl(n,t,c.Xu);var h=new nl(e,t,a);return n.ic.set(e,h),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),c.snapshot}async function al(e,t,n){const r=bl(e);try{const e=await function(e,s){const i=e,a=Or.now(),o=s.reduce((e,t)=>e.add(t.key),La());let u,c;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=xa,r=La();return i.Gi.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,t)).next(e=>{u=e;const t=[];for(const n of s){const s=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Xi(r.transform,e||null);null!=s&&(null===n&&(n=Ii.empty()),n.set(r.field,s))}return n||null}(n,u.get(n.key).overlayedDocument);null!=s&&t.push(new pa(n.key,s,function r(e){const s=[];return ps(e.fields,(e,t)=>{const n=new Br([e]);if(Us(t)){const e=r(t.mapValue).fields;if(0===e.length)s.push(n);else for(const t of e)s.push(n.child(t))}else s.push(n)}),new wi(s)}(s.value.mapValue),ua.exists(!0)))}return i.mutationQueue.addMutationBatch(n,a,t,s)}).next(e=>{var t=(c=e).applyToLocalDocumentSet(u,r);return i.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:c.batchId,changes:Ca(u)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.hc[e.currentUser.toKey()];r=r||new fi(Rr),r=r.insert(t,n),e.hc[e.currentUser.toKey()]=r}(r,e.batchId,n),await pl(r,e.changes),await kh(r.remoteStore)}catch(e){const t=qh(e,"Failed to persist write");n.reject(t)}}async function ol(e,t){const r=e;try{const e=await Bc(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.cc.get(t);n&&(wr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.nc=!0:0<e.modifiedDocuments.size?wr(n.nc):0<e.removedDocuments.size&&(wr(n.nc),n.nc=!1))}),await pl(r,e,t)}catch(e){await Zr(e)}}function ul(r,s,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.ic.forEach((e,t)=>{var n=t.view.bu(s);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.bu(n)&&(r=!0)}),r&&zh(t)}(t.eventManager,s),r.length&&t.sc.Wo(r),t.onlineState=s,t.isPrimaryClient&&t.sharedClientState.setOnlineState(s)}}async function cl(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=s.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,r,s){const i=r.batch,n=i.keys();let a=es.resolve();return n.forEach(n=>{a=a.next(()=>s.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);wr(null!==t),e.version.compareTo(t)<0&&(i.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),s.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(s,e,r,n).next(()=>n.apply(e)).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=La();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>s.localDocuments.getDocuments(e,t))})}(n.localStore,t);ll(n,r,null),hl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await pl(n,e)}catch(e){await Zr(e)}}function hl(e,t){(e.lc.get(t)||[]).forEach(e=>{e.resolve()}),e.lc.delete(t)}function ll(e,t,n){const r=e;let s=r.hc[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.hc[r.currentUser.toKey()]=s}}function dl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(e=>{t.ac.containsKey(e)||fl(t,e)})}function fl(e,t){e.oc.delete(t.path.canonicalString());var n=e.uc.get(t);null!==n&&(Th(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),ml(e))}function gl(e,t,n){for(const r of n)r instanceof Zh?(e.ac.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(gr("SyncEngine","New document in limbo: "+n),e.oc.add(r),ml(e))}(e,r)):r instanceof el?(gr("SyncEngine","Document no longer in limbo: "+r.key),e.ac.removeReference(r.key,t),e.ac.containsKey(r.key)||fl(e,r.key)):vr()}function ml(e){for(;0<e.oc.size&&e.uc.size<e.maxConcurrentLimboResolutions;){var t=e.oc.values().next().value;e.oc.delete(t);var n=new Ur(Pr.fromString(t)),t=e.fc.next();e.cc.set(t,new rl(n)),e.uc=e.uc.insert(n,t),bh(e.remoteStore,new Ho(Pi(Ri(n.path)),t,2,ds.at))}}async function pl(e,t,r){const s=e,i=[],a=[],o=[];s.ic.isEmpty()||(s.ic.forEach((e,n)=>{o.push(s._c(n,t,r).then(e=>{var t;(e||r)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(n.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(i.push(e),t=Mc.Ci(n.targetId,e),a.push(t))}))}),await Promise.all(o),s.sc.Wo(i),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>es.forEach(t,t=>es.forEach(t.Si,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>es.forEach(t.Di,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!is(e))throw e;gr("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.qi.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.qi=r.qi.insert(t,s)}}}(s.localStore,a))}async function yl(r,e){const s=r;if(Il(s),bl(s),!0===e&&!0!==s.dc){const r=s.sharedClientState.getAllActiveQueryTargets(),e=await vl(s,r.toArray());s.dc=!0,await Oh(s.remoteStore,!0);for(const r of e)bh(s.remoteStore,r)}else if(!1===e&&!1!==s.dc){const r=[];let n=Promise.resolve();s.rc.forEach((e,t)=>{s.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(dl(s,t),Kc(s.localStore,t,!0))),Th(s.remoteStore,t)}),await n,await vl(s,r),function(){const n=s;n.cc.forEach((e,t)=>{Th(n.remoteStore,t)}),n.ac.fs(),n.cc=new Map,n.uc=new fi(Ur.comparator)}(),s.dc=!1,await Oh(s.remoteStore,!1)}}async function vl(t,n){const r=t,s=[],i=[];for(const t of n){let e;const h=r.rc.get(t);if(h&&0!==h.length){e=await Gc(r.localStore,Pi(h[0]));for(const t of h){const n=r.ic.get(t),h=(a=r,o=n,c=u=void 0,c=await jc((u=a).localStore,o.query,!0),c=o.view.tc(c),u.isPrimaryClient&&gl(u,o.targetId,c.Xu),await c);h.snapshot&&i.push(h.snapshot)}}else{const h=await $c(r.localStore,t);e=await Gc(r.localStore,h),await il(r,wl(h),t,!1,e.resumeToken)}s.push(e)}var a,o,u,c;return r.sc.Wo(i),s}function wl(e){return ki(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Il(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=ol.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.cc.get(t);if(r&&r.nc)return La().add(r.key);{let e=La();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.cc.get(t),i=s&&s.key;if(i){let e=new fi(Ur.comparator);e=e.insert(i,bi.newNoDocument(i,Fr.min()));const n=La().add(i),s=new Oa(Fr.min(),new Map,new pi(Rr),e,n);await ol(r,s),r.uc=r.uc.remove(i),r.cc.delete(t),ml(r)}else await Kc(r.localStore,t,!1).then(()=>dl(r,t,n)).catch(Zr)}).bind(null,t),t.sc.Wo=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.Pu(e)&&(r=!0);s.Au=e}}r&&zh(n)}).bind(null,t.eventManager),t.sc.wc=(function(e,t,n){const r=e,s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function bl(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=cl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return s.mutationQueue.lookupMutationBatch(t,r).next(e=>(wr(null!==e),n=e.keys(),s.mutationQueue.removeMutationBatch(t,e))).next(()=>s.mutationQueue.performConsistencyCheck(t)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>s.localDocuments.getDocuments(t,n))})}(r.localStore,t);ll(r,t,n),hl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await pl(r,e)}catch(n){await Zr(n)}}).bind(null,t),t}class Tl{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=lh(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Vc(this.persistence,new Oc,e.initialUser,this.yt)}yc(e){return new _c(xc.Bs,this.yt)}gc(e){return new rh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class El extends Tl{constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await bl(this.Ac.syncEngine),await kh(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return Vc(this.persistence,new Oc,e.initialUser,this.yt)}Tc(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new tc(n,e.asyncQueue,t)}Ec(e,t){var n=new ls(t,this.persistence);return new hs(e.asyncQueue,n)}yc(e){var t=Lc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Bu.withCacheSize(this.cacheSizeBytes):Bu.DEFAULT;return new Nc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ch(),hh(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new rh}}class _l extends El{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.Ac.syncEngine;this.sharedClientState instanceof nh&&(this.sharedClientState.syncEngine={Fr:(async function(e,t,n,r){var s=e,i=await function(e,n){const r=e,s=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Tn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):es.resolve(null)))}(s.localStore,t);null!==i?("pending"===n?await kh(s.remoteStore):"acknowledged"===n||"rejected"===n?(ll(s,t,r||null),hl(s,t),s.localStore.mutationQueue.An(t)):vr(),await pl(s,i)):gr("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),$r:(async function(e,t,n,r){const s=e;if(s.dc)gr("SyncEngine","Ignoring unexpected query state notification.");else{var i=s.rc.get(t);if(i&&0<i.length)switch(n){case"current":case"not-current":{const e=await Qc(s.localStore,$i(i[0])),r=Oa.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,bs.EMPTY_BYTE_STRING);await pl(s,e,r);break}case"rejected":await Kc(s.localStore,t,!0),dl(s,t,r);break;default:vr()}}}).bind(null,t),Br:(async function(e,t,n){const r=Il(e);if(r.dc){for(const e of t)if(r.rc.has(e))gr("SyncEngine","Adding an already active target "+e);else{const t=await $c(r.localStore,e),n=await Gc(r.localStore,t);await il(r,wl(t),n.targetId,!1,n.resumeToken),bh(r.remoteStore,n)}for(const e of n)r.rc.has(e)&&await Kc(r.localStore,e,!1).then(()=>{Th(r.remoteStore,e),dl(r,e)}).catch(Zr)}}).bind(null,t),vi:(function(e){return e.localStore.persistence.vi()}).bind(null,t),Mr:(async function(e,t){const n=e;return Qc(n.localStore,t).then(e=>pl(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.li(async e=>{await yl(this.Ac.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}gc(e){var t=ch();if(!nh.C(t))throw new br(Ir.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Lc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new nh(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Sl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ul(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){gr("SyncEngine","User change. New user:",t.toKey());const r=await Pc(n.localStore,t);n.currentUser=t,(e=n).lc.forEach(e=>{e.forEach(e=>{e.reject(new br(Ir.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.lc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await pl(n,r.ji)}}).bind(null,this.syncEngine),await Oh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new jh}createDatastore(e){var t,n,r,s,i=lh(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new uh(t));return n=e.authCredentials,r=e.appCheckCredentials,s=t,e=i,new ph(n,r,s,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,s=e=>ul(this.syncEngine,e,0),i=new(ih.C()?ih:sh),new vh(t,n,r,s,i);var t,n,r,s,i}createSyncEngine(e,t){return function(e,t,n,r,s,i,a){const o=new sl(e,t,n,r,s,i);return a&&(o.dc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;gr("RemoteStore","RemoteStore shutting down."),t._u.add(5),await Ih(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function xl(e,t,n){if(!n)throw new br(Ir.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Dl(e,t,n,r){if(!0===t&&!0===r)throw new br(Ir.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Al(e){if(!Ur.isDocumentKey(e))throw new br(Ir.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Cl(e){if(Ur.isDocumentKey(e))throw new br(Ir.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Nl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":vr();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function kl(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new br(Ir.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Nl(e);throw new br(Ir.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function Rl(e,t){if(t<=0)throw new br(Ir.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const Ll=new Map;class Ml{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new br(Ir.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new br(Ir.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Dl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ol{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ml({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new br(Ir.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new br(Ir.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ml(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new _r;switch(e.type){case"gapi":var t=e.client;return new Ar(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new br(Ir.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Ll.get(e);t&&(gr("ComponentProvider","Removing Datastore"),Ll.delete(e),t.terminate())}(this),Promise.resolve()}}function Fl(n,e,t,r={}){var s;const i=(n=kl(n,Ol))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&pr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=hr.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new br(Ir.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new hr(i)}n._authCredentials=new Sr(new Er(e,t))}}class Vl{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ql(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Vl(this.firestore,e,this._key)}}class Pl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pl(this.firestore,e,this._query)}}class ql extends Pl{constructor(e,t,n){super(e,t,Ri(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Vl(this.firestore,null,new Ur(e))}withConverter(e){return new ql(this.firestore,e,this._path)}}function Bl(e,t,...n){if(e=m(e),xl("collection","path",t),e instanceof Ol){var r=Pr.fromString(t,...n);return Cl(r),new ql(e,null,r)}if(!(e instanceof Vl||e instanceof ql))throw new br(Ir.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Pr.fromString(t,...n));return Cl(r),new ql(e.firestore,null,r)}function Ul(e,t,...n){if(e=m(e),xl("doc","path",t=1===arguments.length?kr.R():t),e instanceof Ol){var r=Pr.fromString(t,...n);return Al(r),new Vl(e,null,new Ur(r))}if(!(e instanceof Vl||e instanceof ql))throw new br(Ir.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Pr.fromString(t,...n));return Al(r),new Vl(e.firestore,e instanceof ql?e.converter:null,new Ur(r))}function Gl(e,t){return e=m(e),t=m(t),(e instanceof Vl||e instanceof ql)&&(t instanceof Vl||t instanceof ql)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Kl(e,t){return e=m(e),t=m(t),e instanceof Pl&&t instanceof Pl&&e.firestore===t.firestore&&Ui(e._query,t._query)&&e.converter===t.converter}function jl(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class $l{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):mr("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Ql{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Tr,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.ku)}`))},e=>this.metadata.reject(e))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){var e=await this.Sc();if(null===e)return null;var t=this.vc.decode(e),n=Number(t);isNaN(n)&&this.Dc(`length string (${t}) is not valid number`);t=await this.Cc(n);return new Hh(JSON.parse(t),e.length+n)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(0===this.buffer.length)return null;var e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");var t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Nc(){var e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class zl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new br(Ir.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=ro(r.yt)+"/documents",s={documents:t.map(e=>Za(r.yt,e))},i=await r._o("BatchGetDocuments",n,s,t.length),a=new Map;i.forEach(e=>{const t=(n=r.yt,"found"in(e=e)?function(e,t){wr(!!t.found),t.found.name,t.found.updateTime;var n=eo(e,t.found.name),r=Ya(t.found.updateTime),s=t.found.createTime?Ya(t.found.createTime):Fr.min(),i=new Ii({mapValue:{fields:t.found.fields}});return bi.newFoundDocument(n,r,s,i)}(n,e):"missing"in e?function(e,t){wr(!!t.missing),wr(!!t.readTime);var n=eo(e,t.missing),r=Ya(t.readTime);return bi.newNoDocument(n,r)}(n,e):vr());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());wr(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ia(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=Ur.fromPath(t);this.mutations.push(new ba(n,this.precondition(n)))}),await async function(e,t){const n=e,r=ro(n.yt)+"/documents",s={writes:t.map(e=>oo(n.yt,e))};await n.ao("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw vr();t=Fr.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new br(Ir.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Fr.min())?ua.exists(!1):ua.updateTime(t):ua.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return ua.exists(!0);if(t.isEqual(Fr.min()))throw new br(Ir.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ua.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Wl{constructor(e,t,n,r,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=s,this.kc=n.maxAttempts,this.xo=new dh(this.asyncQueue,"transaction_retry")}run(){--this.kc,this.Oc()}Oc(){this.xo.Ro(async()=>{const t=new zl(this.datastore),e=this.Mc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Fc(e)}))}).catch(e=>{this.Fc(e)})})}Mc(e){try{var t=this.updateFunction(e);return!vs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){0<this.kc&&this.$c(e)?(--this.kc,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Ea(t)}}class Hl{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=hr.UNAUTHENTICATED,this.clientId=kr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{gr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(gr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new br(Ir.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new Tr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=qh(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function Yl(e,t){e.asyncQueue.verifyOperationInProgress(),gr("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Pc(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function Xl(e,n){e.asyncQueue.verifyOperationInProgress();var t=await Jl(e);gr("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>Mh(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>Mh(n.remoteStore,t)),e.onlineComponents=n}async function Jl(e){return e.offlineComponents||(gr("FirestoreClient","Using default OfflineComponentProvider"),await Yl(e,new Tl)),e.offlineComponents}async function Zl(e){return e.onlineComponents||(gr("FirestoreClient","Using default OnlineComponentProvider"),await Xl(e,new Sl)),e.onlineComponents}function ed(e){return Jl(e).then(e=>e.persistence)}function td(e){return Jl(e).then(e=>e.localStore)}function nd(e){return Zl(e).then(e=>e.remoteStore)}function rd(e){return Zl(e).then(e=>e.syncEngine)}async function sd(e){const t=await Zl(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=Il(e);let r,s;const i=n.ic.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.ec();else{const e=await Gc(n.localStore,Pi(t));n.isPrimaryClient&&bh(n.remoteStore,e);const i=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await il(n,t,r,"current"===i,e.resumeToken)}return s}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.ic.get(t),s=n.rc.get(r.targetId);if(1<s.length)return n.rc.set(r.targetId,s.filter(e=>!Ui(e,t))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Kc(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Th(n.remoteStore,r.targetId),dl(n,r.targetId)}).catch(Zr)):(dl(n,r.targetId),await Kc(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function id(e,t,n={}){const r=new Tr;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,s,i,a){const e=new $l({next:e=>{r.enqueueAndForget(()=>Qh(n,o));var t=e.docs.has(s);!t&&e.fromCache?a.reject(new br(Ir.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&i&&"server"===i.source?a.reject(new br(Ir.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new Wh(Ri(s.path),e,{includeMetadataChanges:!0,Nu:!0});return $h(n,o)}(await sd(e),e.asyncQueue,t,n,r)),r.promise}function ad(e,t,n={}){const r=new Tr;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,s){const i=new $l({next:e=>{n.enqueueAndForget(()=>Qh(t,a)),e.fromCache&&"server"===r.source?s.reject(new br(Ir.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(e)},error:e=>s.reject(e)}),a=new Wh(e,i,{includeMetadataChanges:!0,Nu:!0});return $h(t,a)}(await sd(e),e.asyncQueue,t,n,r)),r.promise}function od(e,t,n,r){const s=(n=n,t=lh(t),i="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return jl(e,void 0);if(e instanceof ArrayBuffer)return jl(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(i),t=t,new Ql(n,t));var i;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var s=await n.getMetadata();if(await function(e,t){const n=e,r=Ya(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ns.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,s))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:s.totalDocuments,bytesLoaded:s.totalBytes,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}),Promise.resolve(new Set);r._updateProgress(Jh(s));const a=new Xh(s,t.localStore,n.yt);let e=await n.mc();for(;e;){const t=await a.Fu(e);t&&r._updateProgress(t),e=await n.mc()}var i=await a.complete();return await pl(t,i.Lu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ns.saveBundleMetadata(e,t))}(t.localStore,s),r._completeWith(i.progress),Promise.resolve(i.Bu)}catch(t){return pr("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await rd(e),s,r)})}class ud{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new dh(this,"async_queue_retry"),this.Wc=()=>{var e=hh();e&&gr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=hh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=hh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Tr;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!is(e))throw e;gr("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Lc.length&&this.xo.Ro(()=>this.Jc())}}Hc(e){var t=this.Bc.then(()=>(this.Gc=!0,e().catch(e=>{throw this.Kc=e,this.Gc=!1,mr("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Gc=!1,e))));return this.Bc=t}enqueueAfterDelay(e,t,n){this.zc(),-1<this.jc.indexOf(e)&&(t=0);var r=Ph.createAndSchedule(this,e,t,n,e=>this.Yc(e));return this.Uc.push(r),r}zc(){this.Kc&&vr()}verifyOperationInProgress(){}async Xc(){for(var e;await(e=this.Bc),e!==this.Bc;);}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(t){return this.Xc().then(()=>{this.Uc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Uc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){var t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function cd(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class hd{constructor(){this._progressObserver={},this._taskCompletionResolver=new Tr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var ld,dd,fd;class gd extends Ol{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ud,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||pd(this),this._firestoreClient.terminate()}}function md(e){return e._firestoreClient||pd(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function pd(e){var t,n,r,s,i,a=e._freezeSettings(),a=(n=e._databaseId,r=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",s=e._persistenceKey,i=a,new fs(n,r,s,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new Hl(e._authCredentials,e._appCheckCredentials,e._queue,a)}function yd(e,n,r){const s=new Tr;return e.asyncQueue.enqueue(async()=>{try{await Yl(e,r),await Xl(e,n),s.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===Ir.FAILED_PRECONDITION||t.code===Ir.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw n;pr("Error enabling offline persistence. Falling back to persistence disabled: "+n),s.reject(n)}var t}).then(()=>s.promise)}function vd(e){return function(e){const t=new Tr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;Dh(n.remoteStore)||gr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.lc.get(e)||[];r.push(t),n.lc.set(e,r)}catch(e){const n=qh(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await rd(e),t)),t.promise}(md(e=kl(e,gd)))}function wd(e){return(n=md(e=kl(e,gd))).asyncQueue.enqueue(async()=>{const e=await ed(n),t=await nd(n);return e.setNetworkEnabled(!0),function(){const e=t;return e._u.delete(0),wh(e)}()});var n}function Id(e){return(n=md(e=kl(e,gd))).asyncQueue.enqueue(async()=>{const e=await ed(n),t=await nd(n);return e.setNetworkEnabled(!1),async function(){const e=t;e._u.add(0),await Ih(e),e.gu.set("Offline")}()});var n}function bd(t,e){return n=md(t=kl(t,gd)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ns.getNamedQuery(e,t))}(await td(n),r)).then(e=>e?new Pl(t,null,e.query):null);var n,r}function Td(e){if(e._initialized||e._terminated)throw new br(Ir.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ed{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ed(bs.fromBase64String(e))}catch(e){throw new br(Ir.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Ed(bs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class _d{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new br(Ir.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Br(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Sd{constructor(e){this._methodName=e}}class xd{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new br(Ir.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new br(Ir.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Rr(this._lat,e._lat)||Rr(this._long,e._long)}}const Dd=/^__.*__$/;class Ad{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new pa(e,this.data,this.fieldMask,t,this.fieldTransforms):new ma(e,this.data,t,this.fieldTransforms)}}class Cd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new pa(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Nd(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw vr()}}class kd{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new kd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Xd(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Nd(this.sa)&&Dd.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class Rd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||lh(e)}da(e,t,n,r=!1){return new kd({sa:e,methodName:t,fa:n,path:Br.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Ld(e){var t=e._freezeSettings(),n=lh(e._databaseId);return new Rd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Md(e,t,n,r,s,i={}){const a=e.da(i.merge||i.mergeFields?2:0,t,n,s);zd("Data must be an object, but it was:",a,r);var o=$d(r,a);let u,c;if(i.merge)u=new wi(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=Wd(t,r,n);if(!a.contains(s))throw new br(Ir.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Jd(e,s)||e.push(s)}u=new wi(e),c=a.fieldTransforms.filter(e=>u.covers(e.field))}else u=null,c=a.fieldTransforms;return new Ad(new Ii(o),u,c)}class Od extends Sd{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Od}}function Fd(e,t,n){return new kd({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.yt,t.ignoreUndefinedProperties)}class Vd extends Sd{_toFieldTransform(e){return new aa(e.path,new Ji)}isEqual(e){return e instanceof Vd}}class Pd extends Sd{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Fd(this,e,!0),n=this._a.map(e=>jd(e,t)),r=new Zi(n);return new aa(e.path,r)}isEqual(e){return this===e}}class qd extends Sd{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Fd(this,e,!0),n=this._a.map(e=>jd(e,t)),r=new ta(n);return new aa(e.path,r)}isEqual(e){return this===e}}class Bd extends Sd{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){var t=new ra(e.yt,Hi(e.yt,this.wa));return new aa(e.path,t)}isEqual(e){return this===e}}function Ud(e,s,i,t){const a=e.da(1,s,i);zd("Data must be an object, but it was:",a,t);const o=[],u=Ii.empty();ps(t,(e,t)=>{var n=Yd(s,e,i);t=m(t);var r=a.ca(n);if(t instanceof Od)o.push(n);else{const e=jd(t,r);null!=e&&(o.push(n),u.set(n,e))}});var n=new wi(o);return new Cd(u,n,a.fieldTransforms)}function Gd(e,t,n,r,s,i){const a=e.da(1,t,n),o=[Wd(t,r,n)],u=[s];if(i.length%2!=0)throw new br(Ir.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)o.push(Wd(t,i[f])),u.push(i[f+1]);const c=[],h=Ii.empty();for(let g=o.length-1;0<=g;--g)if(!Jd(c,o[g])){const t=o[g];var l=m(l=u[g]);const r=a.ca(t);if(l instanceof Od)c.push(t);else{const e=jd(l,r);null!=e&&(c.push(t),h.set(t,e))}}var d=new wi(c);return new Cd(h,d,a.fieldTransforms)}function Kd(e,t,n,r=!1){return jd(n,e.da(r?4:3,t))}function jd(i,e){if(Qd(i=m(i)))return zd("Unsupported field value:",e,i),$d(i,e);if(i instanceof Sd)return function(e,t){if(!Nd(t.sa))throw t.ha(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ha(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(i,e),null;if(void 0===i&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const s of i){let e=jd(s,t.aa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=m(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Hi(t.yt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Or.fromDate(e);return{timestampValue:Wa(t.yt,n)}}if(e instanceof Or){n=new Or(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Wa(t.yt,n)}}if(e instanceof xd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ed)return{bytesValue:Ha(t.yt,e._byteString)};if(e instanceof Vl){const r=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(r))throw t.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Xa(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha(`Unsupported field value: ${Nl(e)}`)}(0,e)}function $d(e,r){const s={};return ys(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):ps(e,(e,t)=>{var n=jd(t,r.ra(e));null!=n&&(s[e]=n)}),{mapValue:{fields:s}}}function Qd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Or||e instanceof xd||e instanceof Ed||e instanceof Vl||e instanceof Sd)}function zd(e,t,n){if(!Qd(n)||("object"!=typeof(s=n)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s))){var r=Nl(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}var s}function Wd(e,t,n){if((t=m(t))instanceof _d)return t._internalPath;if("string"==typeof t)return Yd(e,t);throw Xd("Field path arguments must be of type string or ",e,!1,void 0,n)}const Hd=new RegExp("[~\\*/\\[\\]]");function Yd(t,n,r){if(0<=n.search(Hd))throw Xd(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new _d(...n.split("."))._internalPath}catch(e){throw Xd(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function Xd(e,t,n,r,s){var i=r&&!r.isEmpty(),a=void 0!==s;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new br(Ir.INVALID_ARGUMENT,o+e+u)}function Jd(e,t){return e.some(e=>e.isEqual(t))}class Zd{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Vl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new ef(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(tf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ef extends Zd{data(){return super.data()}}function tf(e,t){return"string"==typeof t?Yd(e,t):(t instanceof _d?t:t._delegate)._internalPath}function nf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new br(Ir.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rf{}class sf extends rf{}function af(e,t,...n){let r=[];t instanceof rf&&r.push(t),r=r.concat(n),function(e){var t=e.filter(e=>e instanceof uf).length,n=e.filter(e=>e instanceof of).length;if(1<t||0<t&&0<n)throw new br(Ir.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class of extends sf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new of(e,t,n)}_apply(e){var t=this._parse(e);return pf(e._query,t),new Pl(e.firestore,e.converter,qi(e._query,t))}_parse(e){var t=Ld(e.firestore);return function(e,t,n,r,s,i,a){let o;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new br(Ir.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){mf(a,i);const t=[];for(const n of a)t.push(gf(r,e,n));o={arrayValue:{values:t}}}else o=gf(r,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||mf(a,i),o=Kd(n,t,a,"in"===i||"not-in"===i);return Ys.create(s,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class uf extends rf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uf(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:Xs.create(e,this._getOperator())}_apply(e){const n=this._parse(e);return 0===n.getFilters().length?e:(function(e){let t=e;for(const e of n.getFlattenedFilters())pf(t,e),t=qi(t,e)}(e._query),new Pl(e.firestore,e.converter,qi(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class cf extends sf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cf(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new br(Ir.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new br(Ir.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,s=new di(t,n);return n=s,null!==Mi(e=e)||null!==(r=Oi(e))&&yf(0,r,n.field),s}(e._query,this._field,this._direction);return new Pl(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new Ni(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class hf extends sf{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new hf(e,t,n)}_apply(e){return new Pl(e.firestore,e.converter,Bi(e._query,this._limit,this._limitType))}}class lf extends sf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new lf(e,t,n)}_apply(e){var t,n=ff(e,this.type,this._docOrFields,this._inclusive);return new Pl(e.firestore,e.converter,(t=e._query,e=n,new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class df extends sf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new df(e,t,n)}_apply(e){var t,n=ff(e,this.type,this._docOrFields,this._inclusive);return new Pl(e.firestore,e.converter,(t=e._query,e=n,new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function ff(e,t,n,r){if(n[0]=m(n[0]),n[0]instanceof Zd)return function(e,t,n,r,s){if(!r)throw new br(Ir.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Vi(e))if(n.field.isKeyField())i.push(Fs(t,r.key));else{const e=r.data.field(n.field);if(xs(e))throw new br(Ir.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new br(Ir.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new Qs(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var s=Ld(e.firestore);return function(e,t,n,r,s,i){const a=e.explicitOrderBy;if(s.length>a.length)throw new br(Ir.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let u=0;u<s.length;u++){const c=s[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new br(Ir.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Fi(e)&&-1!==c.indexOf("/"))throw new br(Ir.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(Pr.fromString(c));if(!Ur.isDocumentKey(n))throw new br(Ir.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new Ur(n);o.push(Fs(t,s))}else{const e=Kd(n,r,c);o.push(e)}}return new Qs(o,i)}(e._query,e.firestore._databaseId,s,t,n,r)}function gf(e,t,n){if("string"==typeof(n=m(n))){if(""===n)throw new br(Ir.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fi(t)&&-1!==n.indexOf("/"))throw new br(Ir.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(Pr.fromString(n));if(!Ur.isDocumentKey(r))throw new br(Ir.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Fs(e,new Ur(r))}if(n instanceof Vl)return Fs(e,n._key);throw new br(Ir.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nl(n)}.`)}function mf(e,t){if(!Array.isArray(e)||0===e.length)throw new br(Ir.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new br(Ir.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function pf(e,t){if(t.isInequality()){const r=Oi(e),s=t.field;if(null!==r&&!r.isEqual(s))throw new br(Ir.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${s.toString()}'`);var n=Mi(e);null!==n&&yf(0,s,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new br(Ir.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new br(Ir.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function yf(e,t,n){if(!n.isEqual(t))throw new br(Ir.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class vf{convertValue(e,t="none"){switch(Ns(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _s(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ss(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw vr()}}convertObject(e,n){const r={};return ps(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new xd(_s(e.latitude),_s(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return xs(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ds(e));default:return null}}convertTimestamp(e){var t=Es(e);return new Or(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Pr.fromString(e);wr(yo(n));const r=new gs(n.get(1),n.get(3)),s=new Ur(n.popFirst(5));return r.isEqual(t)||mr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function wf(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class If extends vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ed(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Vl(this.firestore,null,t)}}class bf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Tf extends Zd{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new Ef(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(tf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ef extends Tf{data(e={}){return super.data(e)}}class _f{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new bf(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new Ef(this._firestore,this._userDataWriter,e.key,e,new bf(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new br(Ir.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){let n=0;return i._snapshot.docChanges.map(e=>{var t=new Ef(i._firestore,i._userDataWriter,e.doc.key,e.doc,new bf(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new Ef(i._firestore,i._userDataWriter,e.doc.key,e.doc,new bf(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(s=s.add(e.doc),r=s.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return vr()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Sf(e,t){return e instanceof Tf&&t instanceof Tf?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof _f&&t instanceof _f&&e._firestore===t._firestore&&Kl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class xf extends vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ed(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Vl(this.firestore,null,t)}}function Df(t){t=kl(t,Vl);const n=kl(t.firestore,gd),e=md(n),r=new xf(n);return function(e,t){const n=new Tr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const s=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new br(Ir.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=qh(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await td(e),t,n)),n.promise}(e,t._key).then(e=>new Tf(n,r,t._key,e,new bf(null!==e&&e.hasLocalMutations,!0),t.converter))}function Af(t){t=kl(t,Pl);const n=kl(t.firestore,gd),e=md(n),r=new xf(n);return function(e,t){const n=new Tr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const s=await jc(e,t,!0),i=new tl(t,s.Hi),a=i.Wu(s.documents),o=i.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=qh(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await td(e),t,n)),n.promise}(e,t._query).then(e=>new _f(n,r,t,e))}function Cf(e,t,n){e=kl(e,Vl);var r=kl(e.firestore,gd),s=wf(e.converter,t,n);return Lf(r,[Md(Ld(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,ua.none())])}function Nf(e,t,n,...r){e=kl(e,Vl);var s=kl(e.firestore,gd),i=Ld(s);let a;return a="string"==typeof(t=m(t))||t instanceof _d?Gd(i,"updateDoc",e._key,t,n,r):Ud(i,"updateDoc",e._key,t),Lf(s,[a.toMutation(e._key,ua.exists(!0))])}function kf(t,...n){var e;t=m(t);let r={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||cd(n[s])||(r=n[s],s++);var i={includeMetadataChanges:r.includeMetadataChanges};if(cd(n[s])){const t=n[s];n[s]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[s+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[s+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,u;if(t instanceof Vl)o=kl(t.firestore,gd),u=Ri(t._key.path),a={next:e=>{n[s]&&n[s](Mf(o,t,e))},error:n[s+1],complete:n[s+2]};else{const c=kl(t,Pl);o=kl(c.firestore,gd),u=c._query;const h=new xf(o);a={next:e=>{n[s]&&n[s](new _f(o,h,c,e))},error:n[s+1],complete:n[s+2]},nf(t._query)}return function(e,t,n,r){const s=new $l(r),i=new Wh(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>$h(await sd(e),i)),()=>{s.bc(),e.asyncQueue.enqueueAndForget(async()=>Qh(await sd(e),i))}}(md(o),u,i,a)}function Rf(e,t){return function(e,t){const n=new $l(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Ru.add(t),t.next()}(await sd(e),n)),()=>{n.bc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Ru.delete(t)}(await sd(e),n))}}(md(e=kl(e,gd)),cd(t)?t:{next:t})}function Lf(e,t){return function(e,t){const n=new Tr;return e.asyncQueue.enqueueAndForget(async()=>al(await rd(e),t,n)),n.promise}(md(e),t)}function Mf(e,t,n){var r=n.docs.get(t._key),s=new xf(e);return new Tf(e,s,t._key,r,new bf(n.hasPendingWrites,n.fromCache),t.converter)}const Of={maxAttempts:5};class Ff{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ld(e)}set(e,t,n){this._verifyNotCommitted();const r=Vf(e,this._firestore),s=wf(r.converter,t,n),i=Md(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,ua.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var s=Vf(e,this._firestore);let i;return i="string"==typeof(t=m(t))||t instanceof _d?Gd(this._dataReader,"WriteBatch.update",s._key,t,n,r):Ud(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,ua.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=Vf(e,this._firestore);return this._mutations=this._mutations.concat(new Ia(t._key,ua.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new br(Ir.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vf(e,t){if((e=m(e)).firestore!==t)throw new br(Ir.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Pf extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ld(e)}get(e){const n=Vf(e,this._firestore),r=new If(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return vr();const t=e[0];if(t.isFoundDocument())return new Zd(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Zd(this._firestore,r,n._key,null,n.converter);throw vr()})}set(e,t,n){var r=Vf(e,this._firestore),s=wf(r.converter,t,n),s=Md(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){var s=Vf(e,this._firestore),i="string"==typeof(t=m(t))||t instanceof _d?Gd(this._dataReader,"Transaction.update",s._key,t,n,r):Ud(this._dataReader,"Transaction.update",s._key,t);return this._transaction.update(s._key,i),this}delete(e){var t=Vf(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Vf(e,this._firestore),n=new xf(this._firestore);return super.get(e).then(e=>new Tf(this._firestore,n,t._key,e._document,new bf(!1,!1),t.converter))}}function qf(t,n,e){t=kl(t,gd);var r=Object.assign(Object.assign({},Of),e);return function(){if(r.maxAttempts<1)throw new br(Ir.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const s=new Tr;return t.asyncQueue.enqueueAndForget(async()=>{var e=await Zl(t).then(e=>e.datastore);new Wl(t.asyncQueue,e,r,n,s).run()}),s.promise}(md(t),e=>n(new Pf(t,e)),r)}ld=dg.SDK_VERSION,lr=ld,dg._registerComponent(new h("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),s=new gd(new xr(e.getProvider("auth-internal")),new Nr(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new br(Ir.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gs(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),dg.registerVersion(cr,"3.8.0",void 0),dg.registerVersion(cr,"3.8.0","esm2017");function Bf(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new br("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Uf(){if("undefined"==typeof Uint8Array)throw new br("unimplemented","Uint8Arrays are not available in this environment.")}function Gf(){if("undefined"==typeof atob)throw new br("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Kf{constructor(e){this._delegate=e}static fromBase64String(e){return Gf(),new Kf(Ed.fromBase64String(e))}static fromUint8Array(e){return Uf(),new Kf(Ed.fromUint8Array(e))}toBase64(){return Gf(),this._delegate.toBase64()}toUint8Array(){return Uf(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function jf(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class $f{enableIndexedDbPersistence(e,t){return function(e,t){Td(e=kl(e,gd));var n=md(e),r=e._freezeSettings(),s=new Sl;return yd(n,s,new El(s,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Td(e=kl(e,gd));var t=md(e),n=e._freezeSettings(),r=new Sl;return yd(t,r,new _l(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new br(Ir.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Tr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!ns.C())return Promise.resolve();var t=e+"main";await ns.delete(t)}(Lc(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class Qf{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof gs||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||pr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Fl(this._delegate,e,t,n)}enableNetwork(){return wd(this._delegate)}disableNetwork(){return Id(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Dl("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return vd(this._delegate)}onSnapshotsInSync(e){return Rf(this._delegate,e)}get app(){if(!this._appCompat)throw new br("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ag(this,Bl(this._delegate,e))}catch(e){throw Jf(e,"collection()","Firestore.collection()")}}doc(e){try{return new Xf(this,Ul(this._delegate,e))}catch(e){throw Jf(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new rg(this,function(e,t){if(e=kl(e,Ol),xl("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new br(Ir.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Pl(e,null,(t=t,new Ni(Pr.emptyPath(),t)))}(this._delegate,e))}catch(e){throw Jf(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return qf(this._delegate,e=>t(new Wf(this,e)))}batch(){return md(this._delegate),new Hf(new Ff(this._delegate,e=>Lf(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=md(t=kl(t,gd)),r=new hd,od(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return bd(this._delegate,e).then(e=>e?new rg(this,e):null)}}class zf extends vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kf(new Ed(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return Xf.forKey(t,this.firestore,null)}}class Wf{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new zf(e)}get(e){const t=og(e);return this._delegate.get(t).then(e=>new tg(this._firestore,new Tf(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=og(e);return n?(Bf("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var s=og(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){var t=og(e);return this._delegate.delete(t),this}}class Hf{constructor(e){this._delegate=e}set(e,t,n){var r=og(e);return n?(Bf("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var s=og(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){var t=og(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Yf{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new Ef(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ng(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Yf.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new Yf(e,new zf(e),t),r.set(t,s)),s}}Yf.INSTANCES=new WeakMap;class Xf{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new zf(e)}static forPath(e,t,n){if(e.length%2!=0)throw new br("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new Xf(t,new Vl(t._delegate,n,new Ur(e)))}static forKey(e,t,n){return new Xf(t,new Vl(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new ag(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ag(this.firestore,Bl(this._delegate,e))}catch(e){throw Jf(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=m(e))instanceof Vl&&Gl(this._delegate,e)}set(e,t){t=Bf("DocumentReference.set",t);try{return t?Cf(this._delegate,e,t):Cf(this._delegate,e)}catch(e){throw Jf(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Nf(this._delegate,e):Nf(this._delegate,e,t,...n)}catch(e){throw Jf(e,"updateDoc()","DocumentReference.update()")}}delete(){return Lf(kl((e=this._delegate).firestore,gd),[new Ia(e._key,ua.none())]);var e}onSnapshot(...e){var t=Zf(e),n=eg(e,e=>new tg(this.firestore,new Tf(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return kf(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?Df:"server"===(null==e?void 0:e.source)?function(t){t=kl(t,Vl);const n=kl(t.firestore,gd);return id(md(n),t._key,{source:"server"}).then(e=>Mf(n,t,e))}:function(t){t=kl(t,Vl);const n=kl(t.firestore,gd);return id(md(n),t._key).then(e=>Mf(n,t,e))})(this._delegate),t.then(e=>new tg(this.firestore,new Tf(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Xf(this.firestore,e?this._delegate.withConverter(Yf.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Jf(e,t,n){return e.message=e.message.replace(t,n),e}function Zf(e){for(const t of e)if("object"==typeof t&&!jf(t))return t;return{}}function eg(e,t){var n;let r;return r=jf(e[0])?e[0]:jf(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class tg{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Xf(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Sf(this._delegate,e._delegate)}}class ng extends tg{data(e){var t=this._delegate.data(e);return void 0!==t||vr(),t}}class rg{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new zf(e)}where(e,t,n){try{return new rg(this.firestore,af(this._delegate,(r=n,s=t,i=tf("where",e),of._create(i,s,r))))}catch(e){throw Jf(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,s,i}orderBy(e,t){try{return new rg(this.firestore,af(this._delegate,([n,r="asc"]=[e,t],s=r,i=tf("orderBy",n),cf._create(i,s))))}catch(e){throw Jf(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,s,i}limit(e){try{return new rg(this.firestore,af(this._delegate,(Rl("limit",t=e),hf._create("limit",t,"F"))))}catch(e){throw Jf(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new rg(this.firestore,af(this._delegate,(Rl("limitToLast",t=e),hf._create("limitToLast",t,"L"))))}catch(e){throw Jf(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new rg(this.firestore,af(this._delegate,function(...e){return lf._create("startAt",e,!0)}(...e)))}catch(e){throw Jf(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new rg(this.firestore,af(this._delegate,function(...e){return lf._create("startAfter",e,!1)}(...e)))}catch(e){throw Jf(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new rg(this.firestore,af(this._delegate,function(...e){return df._create("endBefore",e,!1)}(...e)))}catch(e){throw Jf(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new rg(this.firestore,af(this._delegate,function(...e){return df._create("endAt",e,!0)}(...e)))}catch(e){throw Jf(e,"endAt()","Query.endAt()")}}isEqual(e){return Kl(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?Af:"server"===(null==e?void 0:e.source)?function(t){t=kl(t,Pl);const n=kl(t.firestore,gd),e=md(n),r=new xf(n);return ad(e,t._query,{source:"server"}).then(e=>new _f(n,r,t,e))}:function(t){t=kl(t,Pl);const n=kl(t.firestore,gd),e=md(n),r=new xf(n);return nf(t._query),ad(e,t._query).then(e=>new _f(n,r,t,e))})(this._delegate),t.then(e=>new ig(this.firestore,new _f(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=Zf(e),n=eg(e,e=>new ig(this.firestore,new _f(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return kf(this._delegate,t,n)}withConverter(e){return new rg(this.firestore,e?this._delegate.withConverter(Yf.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class sg{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ng(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class ig{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new rg(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ng(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new sg(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new ng(this._firestore,e))})}isEqual(e){return Sf(this._delegate,e._delegate)}}class ag extends rg{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new Xf(this.firestore,e):null}doc(e){try{return void 0===e?new Xf(this.firestore,Ul(this._delegate)):new Xf(this.firestore,Ul(this._delegate,e))}catch(e){throw Jf(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=kl(e.firestore,gd),r=Ul(e),s=wf(e.converter,t);return Lf(n,[Md(Ld(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,ua.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Xf(this.firestore,e))}isEqual(e){return Gl(this._delegate,e._delegate)}withConverter(e){return new ag(this.firestore,e?this._delegate.withConverter(Yf.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function og(e){return kl(e,Vl)}const ug={Firestore:Qf,GeoPoint:xd,Timestamp:Or,Blob:Kf,Transaction:Wf,WriteBatch:Hf,DocumentReference:Xf,DocumentSnapshot:tg,Query:rg,QueryDocumentSnapshot:ng,QuerySnapshot:ig,CollectionReference:ag,FieldPath:class cg{constructor(...e){this._delegate=new _d(...e)}static documentId(){return new cg(Br.keyField().canonicalString())}isEqual(e){return(e=m(e))instanceof _d&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class hg{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Vd("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new hg(e)}static delete(){const e=new Od("deleteField");return e._methodName="FieldValue.delete",new hg(e)}static arrayUnion(...e){const t=function(...e){return new Pd("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new hg(t)}static arrayRemove(...e){const t=function(...e){return new qd("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new hg(t)}static increment(e){const t=new Bd("increment",e);return t._methodName="FieldValue.increment",new hg(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,dr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};dd=t.default,fd=(e,t)=>new Qf(e,t,new $f),dd.INTERNAL.registerComponent(new h("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return fd(t,n)},"PUBLIC").setServiceProps(Object.assign({},ug))),dd.registerVersion("@firebase/firestore-compat","0.3.0")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore-compat.js.map
